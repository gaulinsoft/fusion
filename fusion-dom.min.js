/*! ------------------------------------------------------------------------
//                                   Fusion
//  ------------------------------------------------------------------------
//
//                       Copyright 2014 Nicholas Gaulin
//
//       Licensed under the Apache License, Version 2.0 (the "License");
//      you may not use this file except in compliance with the License.
//                   You may obtain a copy of the License at
//
//                 http://www.apache.org/licenses/LICENSE-2.0
//
//     Unless required by applicable law or agreed to in writing, software
//      distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//     See the License for the specific language governing permissions and
//                       limitations under the License.
*/
(function(v,m){v||(v={});var n=Object,t=n.defineProperty,q=n.freeze,e=n.getPrototypeOf,z=n.preventExtensions,A=n.seal,w=n.prototype.toString,s=Array,k=s.prototype,B=s.isArray,C=Error,D=String.prototype;if(!(n.create&&t&&q&&e&&z&&A&&B&&k.forEach&&k.indexOf&&D.trim))throw new C("JavaScript engine does not support ECMAScript 5.");var x="undefined"!=typeof window&&null!=window&&window.window===window?window:{},h=Element,g=h?h.prototype:null,n=(n=Document)?n.prototype:null,l=g&&"function"==typeof g.matches?
"matches":g&&"function"==typeof g.matchesSelector?"matchesSelector":null;l||(["webkit","moz","ms","o"].forEach(function(a,b,c){l||"function"!=typeof g[a+"MatchesSelector"]||(l=a+"MatchesSelector")}),l||(l="matches"));var q=function(a,b,c,f,d,e){t(a,b,{configurable:!!e,enumerable:!!d,get:c||m,set:f||m})},e=function(a,b,c){t(a,b,{configurable:!0,enumerable:!1,value:c,writable:!0})},r=function(a,b){if(!a||!a.length)return[];for(var c=new s(a.length),f=0,d=c.length;f<d;f++){var e=a[f];c[f]=!b||e instanceof
b?e||null:null}return c},y=function(a,b){var c=/^\s*([a-z][_a-z0-9]*)\s*$/i.exec(b);return c?(c=this.getElementsByTagName(c[1]))&&0<c.length?c[0]:null:a.querySelector(b)},u=function(a,b){var c=/^\s*([a-z][_a-z0-9]*|(?:\.-?[_a-z]+[_a-z0-9\-]*\s*)+)\s*$/i.exec(b);if(!c)return a.querySelectorAll(b);c=c[1];return"."==c[0]?a.getElementsByClassName(c.substr(1).replace(/\s*\./g," ").trim()):a.getElementsByTagName(c)};e(k,"__attrs",function(a,b){if(b===m&&("string"==typeof a||a===m))return this;for(var c=
0,f=this.length;c<f;c++){var d=this[c];d&&d instanceof h&&d.__attr(a,b)}return this});e(k,"__children",function(a){null!=a&&"string"!=typeof a&&(a="");for(var b=null,c=0,f=this.length;c<f;c++){var d=this[c];if(d&&d instanceof h&&d.childElementCount)if(b)for(var e=0,g=d.childElementCount;e<g;e++){var k=d.children[e];(!a||k&&k[l](a))&&b.push(k)}else b=a?d.__children(a):r(d.children)}return b?b:[]});e(k,"__filter",function(a){if(!a||"string"!=typeof a)return[];for(var b=[],c=0,f=this.length;c<f;c++){var d=
this[c];d&&d instanceof h&&d[l](a)&&b.push(d)}return b});e(k,"__find",function(a){if(!a||"string"!=typeof a)return null;for(var b=0,c=this.length;b<c;b++){var f=this[b];if(f&&f instanceof h&&f.childElementCount&&(f=y(f,a)))return f}return null});e(k,"__first",function(a){null!=a&&"string"!=typeof a&&(a="");for(var b=0,c=this.length;b<c;b++){var f=this[b];if(f&&f instanceof h&&(!a||f[l](a)))return f}return null});e(k,"__html",function(a){if(a===m)return this;for(var b=0,c=this.length;b<c;b++){var f=
this[b];f&&f instanceof h&&f.__html(a)}return this});e(k,"__last",function(a){null!=a&&"string"!=typeof a&&(a="");for(var b=this.length-1;0<=b;b--){var c=this[b];if(c&&c instanceof h&&(!a||c[l](a)))return c}return null});e(k,"__matches",function(a){if(!a||"string"!=typeof a)return!1;for(var b=0,c=this.length;b<c;b++){var f=this[b];if(f&&f instanceof h&&f[l](a))return!0}return!1});e(k,"__next",function(a){null!=a&&"string"!=typeof a&&(a="");for(var b=[],c=0,f=this.length;c<f;c++){var d=this[c];d&&
d instanceof h&&(d=d.nextElementSibling,!d||a&&!d[l](a)||b.push(d))}return b});e(k,"__not",function(a){if(!a||"string"!=typeof a)return[];for(var b=[],c=0,f=this.length;c<f;c++){var d=this[c];d&&d instanceof h&&(d[l](a)||b.push(d))}return b});e(k,"__parent",function(a){null!=a&&"string"!=typeof a&&(a="");for(var b=[],c=0,f=this.length;c<f;c++){var d=this[c];d&&d instanceof h&&(d=d.parentNode,d instanceof h&&(!a||d[l](a))&&b.push(d))}return b});e(k,"__prev",function(a){null!=a&&"string"!=typeof a&&
(a="");for(var b=[],c=0,f=this.length;c<f;c++){var d=this[c];d&&d instanceof h&&(d=d.previousElementSibling,!d||a&&!d[l](a)||b.push(d))}return b});e(k,"__query",function(a){if(!a||"string"!=typeof a)return[];for(var b=null,c=0,f=this.length;c<f;c++){var d=this[c];if(d&&d instanceof h&&d.childElementCount&&(d=u(d,a))&&d.length)if(b)for(var e=0,g=d.length;e<g;e++)b.push(d[e]);else b=r(d)}return b?b:[]});e(k,"__remove",function(a){null!=a&&"string"!=typeof a&&(a="");for(var b=a?this.__filter(a):this,
c=0,f=b.length;c<f;c++){var d=b[c];(a||d instanceof h)&&d.parentNode&&d.parentNode.removeChild(d)}return b});e(k,"__styles",function(a,b){if(b===m&&("string"==typeof a||a===m))return this;for(var c=0,f=this.length;c<f;c++){var d=this[c];d&&d instanceof h&&d.__style(a,b)}return this});e(k,"__text",function(a){if(a===m)return this;for(var b=0,c=this.length;b<c;b++){var f=this[b];f&&f instanceof h&&f.__text(a)}return this});var p=null;e(n,"__contains",function(a){return a&&a instanceof h?!!this.documentElement.contains(a):
!1});e(n,"__create",function(a){if(!a||"string"!=typeof a)return null;if("#document"==a)return this.createDocumentFragment();if(/^[a-z][_a-z0-9]*$/i.test(a))return this.createElement(a);if(("<"!=a[0]||">"!=a[a.length-1])&&!/^[a-z][^ >\/\t\r\n\f]*$/i.test(a))return null;p||(p=this.createDocumentFragment().appendChild(this.createElement("div")));p.innerHTML="<"==a[0]?a:"<"+a+"></"+a+">";for(a="<"==a[0]?r(p.children):p.firstElementChild||null;p.hasChildNodes();)p.removeChild(p.lastChild);return a});
e(n,"__find",function(a){if(!a||"string"!=typeof a)return null;var b=/^\s*([a-z][_a-z0-9]*|#[_a-z0-9\-]+)\s*$/i.exec(a);if(!b)return this.querySelector(a)||null;b=b[1];return"#"==b[0]?this.getElementById(b.substr(1))||null:(a=this.getElementsByTagName(b))&&0<a.length?a[0]:null});e(n,"__query",function(a){return a&&"string"==typeof a?r(u(this,a)):[]});e(g,"__after",function(a){if(!(a&&a instanceof h&&this.parentNode))return this;this.parentNode.insertBefore(a,this.nextElementSibling);return this});
e(g,"__append",function(a){if(!(a&&a instanceof h))return this;this.appendChild(a);return this});e(g,"__attr",function(a,b){if(b!==m){if("string"!=typeof a)return this;null===b||!1===b?this.removeAttribute(a):"string"==typeof b?this.setAttribute(a,b):!0===b?this.setAttribute(a,a):"number"==typeof b&&this.setAttribute(a,b.toString());return this}if("string"==typeof a){if(!this.hasAttribute(a))return null;var c=this.getAttribute(a);return"string"==typeof c?c:"number"==typeof c||"boolean"==typeof c?
c.toString():""}if(a===m){if(!this.hasAttributes())return{};for(var f=this.attributes,d={},e=0,g=f.length;e<g;e++)if(c=f[e]){var h=c.name,c=c.value;"string"==typeof h&&(d[h]="string"==typeof c?c:"number"==typeof c||"boolean"==typeof c?c.toString():"")}return d}if(a&&"[object Object]"==w.call(a))for(f in a)this.__attr(f,a[f]);return this});e(g,"__before",function(a){if(!(a&&a instanceof h&&this.parentNode))return this;this.parentNode.insertBefore(a,this);return this});e(g,"__child",function(a){if(!this.childElementCount||
"number"!=typeof a)return null;0>a&&(a+=this.childElementCount);return this.children[a]||null});e(g,"__children",function(a){null!=a&&"string"!=typeof a&&(a="");var b=new s(a?0:this.childElementCount);if(!a&&!b.length)return b;for(var c=0,f=this.childElementCount;c<f;c++){var d=this.children[c];a?d&&d[l](a)&&b.push(d):b[c]=d}return b});e(g,"__contains",function(a){return a&&a instanceof h?!!this.contains(a):!1});e(g,"__find",function(a){return a&&"string"==typeof a?y(this,a)||null:null});e(g,"__first",
function(a){if(!this.childElementCount)return null;if(!a||"string"!=typeof a)return this.firstElementChild||null;for(var b=0,c=this.childElementCount;b<c;b++){var f=this.children[b];if(f&&f[l](a))return f}return null});e(g,"__html",function(a){if(a===m)return a=this.innerHTML,"string"==typeof a?a:"";if("string"==typeof a)this.innerHTML=a;else if(null===a)this.innerHTML="";else if("number"==typeof a||"boolean"==typeof a)this.innerHTML=a.toString();return this});e(g,"__last",function(a){if(!this.childElementCount)return null;
if(!a||"string"!=typeof a)return this.lastElementChild||null;for(var b=this.childElementCount-1;0<=b;b--){var c=this.children[b];if(c&&c[l](a))return c}return null});e(g,"__matches",function(a){return a&&"string"==typeof a?!!this[l](a):!1});e(g,"__next",function(a){var b=this.nextElementSibling;return b?!a||"string"!=typeof a||b[l](a)?b:null:null});e(g,"__parent",function(a){null!=a&&"string"!=typeof a&&(a="");var b=this.parentNode;return b instanceof h&&(!a||b[l](a))?b:null});e(g,"__prepend",function(a){if(!(a&&
a instanceof h))return this;this.insertBefore(a,this.firstChild);return this});e(g,"__prev",function(a){var b=this.previousElementSibling;return b?!a||"string"!=typeof a||b[l](a)?b:null:null});e(g,"__query",function(a){return a&&"string"==typeof a?r(u(this,a)):[]});e(g,"__remove",function(){return this.parentNode?this.parentNode.removeChild(this)||this:this});e(g,"__replace",function(a){if(!(a&&a instanceof h&&this.parentNode))return this;this.parentNode.replaceChild(a,this);return this});e(g,"__style",
function(a,b){if(b!==m){if("string"!=typeof a)return this;if(null===b)this.style.removeProperty(a);else if("string"==typeof b){var c=b.lastIndexOf("!");0<=c&&"important"==b.substr(c+1).trim().toLowerCase()?this.style.setProperty(a,b.substr(0,c).trim(),"important"):this.style.setProperty(a,b)}else"number"!=typeof b&&"boolean"!=typeof b||this.style.setProperty(a,b.toString());return this}if("string"==typeof a)return c=x.getComputedStyle(this),c=c.getPropertyValue(a),"string"==typeof c?c:"number"==typeof c||
"boolean"==typeof c?c.toString():"";if(a===m){var c=x.getComputedStyle(this),f={},d;for(d in c){var e=c.getPropertyValue(d);if("string"==typeof e)f[d]=e;else if("number"==typeof e||"boolean"==typeof e)f[d]=e.toString()}return f}if(a&&"[object Object]"==w.call(a))for(d in a)this.__style(d,a[d]);return this});e(g,"__text",function(a){if(a===m)return a=this.textContent,"string"==typeof a?a:"";if("string"==typeof a)this.textContent=a;else if(null===a)this.textContent="";else if("number"==typeof a||"boolean"==
typeof a)this.textContent=a.toString();return this});q(g,"__document",function(){return this.ownerDocument||null},null,!1,!0);q(g,"__length",function(){return this.childElementCount||0},null,!1,!0);q(g,"__tag",function(){return this.nodeName||""},null,!1,!0)})(this);