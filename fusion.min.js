/*! ------------------------------------------------------------------------
//                                   Fusion
//  ------------------------------------------------------------------------
//
//                       Copyright 2014 Nicholas Gaulin
//
//       Licensed under the Apache License, Version 2.0 (the "License");
//      you may not use this file except in compliance with the License.
//                   You may obtain a copy of the License at
//
//                 http://www.apache.org/licenses/LICENSE-2.0
//
//     Unless required by applicable law or agreed to in writing, software
//      distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//     See the License for the specific language governing permissions and
//                       limitations under the License.
*/
(function(E,fa){E||(E={});var A=Object,G=A.create,Q=A.defineProperty,H=A.freeze,V=A.getPrototypeOf,n=A.keys,W=A.preventExtensions,X=A.seal,Y=A.prototype.hasOwnProperty,L=Array,A=L.prototype,R=L.isArray,L=Error,Z=parseInt,$=String.prototype;if(!(G&&Q&&H&&V&&W&&X&&R&&A.forEach&&A.indexOf&&$.trim))throw new L("JavaScript engine does not support ECMAScript 5.");var H="undefined"!=typeof window&&null!=window&&window.window===window?window:{},M={Aacute:"C1",aacute:"E1",Acirc:"C2",acirc:"E2",acute:"B4",
AElig:"C6",aelig:"E6",Agrave:"C0",agrave:"E0",amp:"26",AMP:"26",Aring:"C5",aring:"E5",Atilde:"C3",atilde:"E3",Auml:"C4",auml:"E4",brvbar:"A6",Ccedil:"C7",ccedil:"E7",cedil:"B8",cent:"A2",copy:"A9",COPY:"A9",curren:"A4",deg:"B0",divide:"F7",Eacute:"C9",eacute:"E9",Ecirc:"CA",ecirc:"EA",Egrave:"C8",egrave:"E8",ETH:"D0",eth:"F0",Euml:"CB",euml:"EB",frac12:"BD",frac14:"BC",frac34:"BE",gt:"3E",GT:"3E",Iacute:"CD",iacute:"ED",Icirc:"CE",icirc:"EE",iexcl:"A1",Igrave:"CC",igrave:"EC",iquest:"BF",Iuml:"CF",
iuml:"EF",laquo:"AB",lt:"3C",LT:"3C",macr:"AF",micro:"B5",middot:"B7",nbsp:"A0",not:"AC",Ntilde:"D1",ntilde:"F1",Oacute:"D3",oacute:"F3",Ocirc:"D4",ocirc:"F4",Ograve:"D2",ograve:"F2",ordf:"AA",ordm:"BA",Oslash:"D8",oslash:"F8",Otilde:"D5",otilde:"F5",Ouml:"D6",ouml:"F6",para:"B6",plusmn:"B1",pound:"A3",quot:"22",QUOT:"22",raquo:"BB",reg:"AE",REG:"AE",sect:"A7",shy:"AD",sup1:"B9",sup2:"B2",sup3:"B3",szlig:"DF",THORN:"DE",thorn:"FE",times:"D7",Uacute:"DA",uacute:"FA",Ucirc:"DB",ucirc:"FB",Ugrave:"D9",
ugrave:"F9",uml:"A8",Uuml:"DC",uuml:"FC",Yacute:"DD",yacute:"FD",yen:"A5",yuml:"FF"},aa=/[<>&'"]/g;n(M).forEach(function(b,e,l){M[b+";"]=M[b]});var s=function(b,e,l,h,n,q){Q(b,e,{configurable:!!q,enumerable:!!n,value:l,writable:!!h})},n="ABCDEFGHIJKLMNOPQRSTUVWXYZ";G(null);var n=n+n.toLowerCase(),I=function(b,e,l){if(!e||!b||e.length>b.length)return!1;if(!l||l>b.length)l=b.length;return e==b.substr(l-e.length)},ba=function(b){return"&#"+b.charCodeAt(0)+";"},O=function(b,e,l){for(l||(l=" ");b.length<
e;)b=l+b;return b},x=function(b,e,l){if(!e||!b||e.length>b.length)return!1;if(!l||0>l)l=0;return e==b.substr(l,e.length)},J=function(b){return"a"<=b&&"z">=b||"A"<=b&&"Z">=b||"0"<=b&&"9">=b},ca=function(b){return"0"==b||"1"==b},w=function(b){return"a"<=b&&"f">=b||"A"<=b&&"F">=b||"0"<=b&&"9">=b},y=function(b){return"a"<=b&&"z">=b||"A"<=b&&"Z">=b},B=function(b){return"\r"==b||"\n"==b||"\u2028"==b||"\u2029"==b},u=function(b){return"0"<=b&&"9">=b},da=function(b){return"0"<=b&&"7">=b},z=function(b){return" "==
b||"\r"==b||"\n"==b||"\t"==b||"\f"==b},S=function(b){return"\t"==b||"\v"==b||"\f"==b||" "==b||"\u00a0"==b||"\ufeff"==b},G=function(b,e){if(0<=b.indexOf(" "))for(var l=b.split(" "),h=0,n=l.length;h<n;h++)s(D,l[h],e);else s(D,b,e)},D=function(){};s(D,"dev",!1,void 0,!0);s(D,"version","1.0.0b",void 0,!0);var K=function(b,e){b&&(this.source=b);e&&(this.language=e);if(b||e)this.chain="fjs"!=this.language&&"js"!=this.language?[new v("")]:[]},n=K.prototype={},ea=function(b,e,l){return b.clone()},N=function(b){return"JavaScriptBlockComment"==
b||"JavaScriptLineComment"==b||"HTMLCommentOpen"==b||"HTMLCommentText"==b||"HTMLCommentClose"==b||"HTMLBogusCommentOpen"==b||"HTMLBogusCommentText"==b||"HTMLBogusCommentClose"==b||"CSSComment"==b},C=function(b,e){if("{"==e||"}"==e)b.braces+="{"==e?1:b.braces?-1:0;else if("("==e||")"==e)b.parentheses+="("==e?1:b.parentheses?-1:0;else if("["==e||"]"==e)b.brackets+="["==e?1:b.brackets?-1:0;else if("<"==e||">"==e)b.tags+="<"==e?1:b.tags?-1:0},T=function(b,e){if(!b)return!0;var l=b.type;return"JavaScriptPunctuator"==
l?(l=b.text(),(")"!=l||e&&("for()"==e||"if()"==e||"while()"==e||"with()"==e))&&("}"!=l||!e||"{}"!=e)&&"]"!=l&&"++"!=l&&"--"!=l):"JavaScriptReservedWord"==l?(l=b.text(),"case"==l||"delete"==l||"do"==l||"else"==l||"extends"==l||"in"==l||"instanceof"==l||"new"==l||"return"==l||"throw"==l||"typeof"==l||"void"==l||"yield"==l):"JavaScriptTemplateString"==l?"`"!=b.source.substr(b.end-1,1):!1},U=function(b){return"JavaScriptInvalidCharacter"==b||"HTMLText"==b||"HTMLEndTagText"==b},F=function(b){return"JavaScriptWhitespace"==
b||"HTMLStartTagWhitespace"==b||"HTMLEndTagWhitespace"==b||"HTMLDOCTYPEWhitespace"==b||"CSSWhitespace"==b};n.chain=null;n.expression="";n.language="fjs";n.position=0;n.source="";n.state="";n.token=null;s(n,"clone",function(){var b=new K(this.source,this.language);b.chain=this.chain?this.chain.map(ea):null;b.expression=this.expression;b.position=this.position;b.state=this.state;b.token=this.token?this.token.clone():null;return b},!0);s(n,"equals",function(b){var e=b.chain,l=this.chain;if(!(l&&l.length)!=
!(e&&e.length))return!1;if(l)for(var h=0,n=l.length;h<n;h++)if(!l[h].equals(e[h]))return!1;return!this.token!=!b.token||this.token&&!this.token.equals(b.token)?!1:this.expression===b.expression&&this.language===b.language&&this.state===b.state},!0);s(n,"next",function(){var b=this.source,e=b.length,l=this.position,h=this.token,n=this.expression,q=this.language,a=this.position,d=this.state||q,k=this.chain,r=k?k.length:0,g=r?k[r-1]:null;if(0>a||a>=e)return null;var m="",f=!1,p=!1,t=null,s="";switch(d){case "js":case "fjs":case "JavaScriptIdentifier":case "JavaScriptReservedWord":case "JavaScriptPunctuator":case "JavaScriptNumber":case "JavaScriptDoubleQuotedString":case "JavaScriptSingleQuotedString":case "JavaScriptTemplateString":case "JavaScriptRegExp":case "JavaScriptBlockComment":case "JavaScriptLineComment":case "JavaScriptInvalidCharacter":case "JavaScriptWhitespace":case "FusionStartTagOpen":case "FusionEndTagOpen":case "FusionDirectiveTagOpen":case "FusionProperty":case "FusionAttributeTemplateStringHead":case "FusionAttributeTemplateStringMiddle":case "FusionSubstitutionOpen":case "FusionObjectSubstitutionOpen":case "FusionSelectorSubstitutionOpen":case "FusionStyleSubstitutionOpen":var c=
b[a];if(y(c)||"_"==c||"$"==c||"\\"==c||"@"==c&&"fjs"==q&&h&&("JavaScriptIdentifier"==h.type||!("JavaScriptPunctuator"!=h.type&&"CSSPunctuator"!=h.type||")"!=b[h.start]&&"]"!=b[h.start]))){"\\"!=c&&a++;d="@"==c?"FusionProperty":"JavaScriptIdentifier";do if(c=b[a],!J(c)&&"_"!=c&&"$"!=c&&"\u200c"!=c&&"\u200d"!=c){if("\\"!=c)break;f=b[a+1];if("u"!=f)break;f=b[a+2];if("{"==f){for(c=0;w(b[a+c+3]);)c++;if(c&&"}"==b[a+c+3])a+=c+3;else break}else if(w(f)&&w(b[a+3])&&w(b[a+4])&&w(b[a+5]))a+=5;else break}while(++a<
e);a==l?(a++,d="JavaScriptInvalidCharacter"):h&&"JavaScriptPunctuator"==h.type&&"."==h.text()||"fjs"==q&&"FusionProperty"==d||((e=b.substring(l,a),"fjs"==q&&h&&("FusionStartTagOpen"==h.type&&("break"==e||"case"==e||"continue"==e||"default"==e||"do"==e||"else"==e||"for"==e||"if"==e||"switch"==e||"while"==e)||"FusionEndTagOpen"==h.type&&"while"==e))?(d="JavaScriptReservedWord",t=new v("FusionEndTagOpen"==h.type?"</@"+e:"<@"+e)):"null"==e||"false"==e||"true"==e||"break"==e||"case"==e||"catch"==e||"class"==
e||"const"==e||"continue"==e||"debugger"==e||"default"==e||"delete"==e||"do"==e||"else"==e||"enum"==e||"export"==e||"extends"==e||"finally"==e||"for"==e||"function"==e||"if"==e||"implements"==e||"import"==e||"in"==e||"instanceof"==e||"interface"==e||"let"==e||"new"==e||"package"==e||"private"==e||"protected"==e||"public"==e||"return"==e||"static"==e||"super"==e||"switch"==e||"this"==e||"throw"==e||"try"==e||"typeof"==e||"var"==e||"void"==e||"while"==e||"with"==e||"yield"==e?((h=h&&"JavaScriptReservedWord"==
h.type?h.text():null)&&("get"==h||"set"==h)||g&&"{"==g.state||(d="JavaScriptReservedWord"),"fjs"!=q||"else"!=h||!g||"<@else"!=g.state||"do"!=e&&"for"!=e&&"if"!=e&&"switch"!=e&&"while"!=e||(m=" "+e)):"get"!=e&&"set"!=e||!g||"{"!=g.state||(e=(f=this.peek(a))?f.type:null,"JavaScriptIdentifier"!=e&&"JavaScriptReservedWord"!=e)||(e=(f=this.peek(f.end))?f.type:null,"JavaScriptPunctuator"==e&&"("==b[f.start]&&(d="JavaScriptReservedWord",s="{:")))}else if(S(c)||B(c)){a++;d="JavaScriptWhitespace";do if(c=
b[a],!S(c)&&!B(c))break;while(++a<e)}else if('"'==c||"'"==c||"`"==c||"}"==c&&g&&0==g.braces&&I(g.state,"`${")){f="}"==c&&"=`${"==g.state;h="}"!=c?c:"`";a++;d=f?"FusionAttributeTemplateStringTail":'"'==h?"JavaScriptDoubleQuotedString":"'"==h?"JavaScriptSingleQuotedString":"JavaScriptTemplateString";"}"==c&&(m=c+h,p=!0);do if(c=b[a],"\\"==c){if(++a>=e)break;"\r"==b[a]&&"\n"==b[a+1]&&a++}else if(c==h){a++;break}else if("`"==h){if("$"==c&&"{"==b[a+1]){a+=2;t=new v(p?g.state:"`${");f&&(d="FusionAttributeTemplateStringMiddle");
break}}else if(B(c))break;while(++a<e)}else if("/"==c)if(f=b[a+1],"*"==f){a+=2;d="JavaScriptBlockComment";do if("*"==b[a]&&"/"==b[a+1]){a+=2;break}while(++a<e)}else if("/"==f)for(a+=2,d="JavaScriptLineComment";!B(b[a]);)a++;else if("fjs"==q&&">"==f&&g&&x(g.state,"<@")&&("<@break"==g.state||"<@case"==g.state||"<@continue"==g.state||"<@default"==g.state||"<@else"==g.state))a+=2,d="FusionStartTagSelfClose",m=c+f,p=!0;else if(a++,T(h,n)){d="JavaScriptRegExp";f=!1;do if(c=b[a],"\\"==c){if(++a>=e||B(b[a]))break}else if(!f&&
"/"==c){a++;break}else if(!f&&"["==c)f=!0;else if(f&&"]"==c)f=!1;else if(B(c))break;while(++a<e);if("/"==c&&(c=b[a],y(c)||"_"==c||"$"==c)){a++;do if(c=b[a],!J(c)&&"_"!=c&&"$"!=c&&"\u200c"!=c&&"\u200d"!=c)break;while(++a<e)}}else d="JavaScriptPunctuator","="==b[a]&&a++;else if(u(c)||"."==c&&u(b[a+1]))if(d="JavaScriptNumber",f="0"==c?b[a+1]:null,"0"!=c||"."==f||"e"==f||"E"==f){if("."!=c){for(a++;u(b[a]);)a++;c=b[a]}if("."==c){for(a++;u(b[a]);)a++;c=b[a]}f=b[a+1];if(("e"==c||"E"==c)&&(u(f)||("+"==f||
"-"==f)&&u(b[a+2])))for(a+="+"==f||"-"==f?3:2;u(b[a]);)a++}else{if(a++,(c="b"==f||"B"==f?ca:"o"==f||"O"==f?da:"x"==f||"X"==f?w:null)&&c(b[a+1]))for(a+=2;c(b[a]);)a++}else if("{"==c){if(a++,d="JavaScriptPunctuator",e=h&&"JavaScriptReservedWord"==h.type?h.text():null,f=h&&"JavaScriptPunctuator"==h.type?h.text():null,k){if(e&&"do"!=e&&"else"!=e&&"export"!=e&&"finally"!=e&&"import"!=e&&"try"!=e||f&&"{"!=f&&";"!=f&&"=>"!=f&&"}"!=f)if("("==f||"["==f||","==f||"?"==f||":"==f||"="==f)t=new v("{");else if(!n||
!I(n,"()"))if(e=(f=this.peek(a))?f.type:null,"JavaScriptIdentifier"==e||"JavaScriptReservedWord"==e||"JavaScriptDoubleQuotedString"==e||"JavaScriptSingleQuotedString"==e)h="JavaScriptIdentifier"==e?f.text():null,e=(f=this.peek(f.end))?f.type:null,"JavaScriptPunctuator"==e&&":"==f.text()?t=new v("{"):"get"!=h&&"set"!=h||"JavaScriptIdentifier"!=e&&"JavaScriptReservedWord"!=e||(e=(f=this.peek(f.end))?f.type:null,"JavaScriptPunctuator"==e&&"("==b[f.start]&&(t=new v("{")));g&&!t&&C(g,c)}}else if("}"==
c){if(a++,d="JavaScriptPunctuator",g){if(0==g.braces)if("fjs"==q&&I(g.state,"${"))d="<${"==g.state?"FusionSubstitutionClose":"@{:${"==g.state?"FusionObjectSubstitutionClose":"@(${"==g.state||"@[${"==g.state?"FusionSelectorSubstitutionClose":"FusionStyleSubstitutionClose",m=c,p=!0;else if("{"==g.state||"{:"==g.state)s="{}",p=!0;p||C(g,c)}}else if("("==c){a++;d="JavaScriptPunctuator";if("fjs"==q&&g&&(x(g.state,"<@")||x(g.state,"</@"))){if(e=g.state,"<@for"==e||"<@if"==e||"<@switch"==e||"<@while"==e||
"<@else for"==e||"<@else if"==e||"<@else switch"==e||"<@else while"==e||"</@while"==e)m=c}else k&&h&&"JavaScriptReservedWord"==h.type&&(h=h.text(),"catch"==h||"function"==h||"for"==h||"if"==h||"switch"==h||"while"==h||"with"==h)&&(t=new v(h+"("));g&&!t&&C(g,c)}else if(")"==c)a++,d="JavaScriptPunctuator",g&&I(g.state,"(")&&("fjs"==q&&(x(g.state,"<@")||x(g.state,"</@"))?1==g.parentheses&&(m=c):0==g.parentheses&&(m=c,p=!0)),g&&!p&&C(g,c);else if("["==c||"]"==c)a++,d="JavaScriptPunctuator",g&&C(g,c);
else if(":"==c)a++,d="JavaScriptPunctuator",g&&0==g.braces&&"{"==g.state&&(s="{:");else if(","==c)a++,d="JavaScriptPunctuator",g&&0==g.braces&&"{:"==g.state&&(s="{");else if(";"==c||"?"==c||"~"==c)a++,d="JavaScriptPunctuator";else if("="==c)c=b[++a],d="JavaScriptPunctuator","="==c?"="==b[++a]&&a++:">"==c&&a++;else if("&"==c||"|"==c||"+"==c||"-"==c)f=b[a+1],a+=c==f||"="==f?2:1,d="JavaScriptPunctuator";else if("!"==c||"*"==c||"^"==c||"%"==c)d="JavaScriptPunctuator","="==b[a+1]?(a+=2,"!"==c&&"="==b[a]&&
a++):a++;else if("<"==c||">"==c)if(f=b[a+1],c==f||"="==f)a+=2,d="JavaScriptPunctuator",c==f&&(c=b[a],">"==f&&">"==c&&(c=b[++a]),"="==c&&a++);else if(a++,d="JavaScriptPunctuator","fjs"==q)if(">"==c&&g&&(x(g.state,"<@")||x(g.state,"</@"))){if(I(g.state,"()")||"<@do"==g.state||"<@else do"==g.state)d=x(g.state,"</@")?"FusionEndTagClose":"FusionStartTagClose",m=c,p=!0}else"<"==c&&"/"==f&&"@"==b[a+1]&&g&&"<@"==g.state?(a+=2,d="FusionEndTagOpen"):">"==c&&h&&"FusionStartTagOpen"==h.type?d="FusionStartTagClose":
">"==c&&h&&"FusionEndTagOpen"==h.type?d="FusionEndTagClose":"<"==c&&y(f)&&T(h,n)&&(d="HTMLStartTagOpen",t=new v("<"),C(t,c));else"<"==c&&"/"==f&&"script"==b.substr(a+1,6)&&g&&"<script"==g.state&&(a++,d="HTMLEndTagOpen",m=">",p=!0);else"."==c?(c=b[++a],d="JavaScriptPunctuator","."==c&&"."==b[a+1]&&(a+=2)):"fjs"==q&&"@"==c?(f=b[a+1],a++,d="{"==f?"FusionObject":"("==f||"["==f?"FusionSelector":"JavaScriptInvalidCharacter",!k||"{"!=f&&"("!=f&&"["!=f||(t=new v(c+f))):(a++,d="JavaScriptInvalidCharacter");
break;case "html":case "fhtml":case "HTMLStartTagClose":case "HTMLStartTagSelfClose":case "HTMLEndTagClose":case "HTMLCharacterReference":case "HTMLCommentClose":case "HTMLBogusCommentClose":case "HTMLDOCTYPEClose":case "HTMLCDATAClose":case "FusionStartTagClose":case "FusionStartTagSelfClose":case "FusionEndTagClose":case "FusionDirectiveTagClose":case "FusionSubstitutionClose":d="HTMLText";case "HTMLText":do if(c=b[a],"<"==c)if(f=b[a+1],y(f)){if(a!=l)break;a++;d="HTMLStartTagOpen";g&&C(g,c);break}else if("/"==
f){if(a!=l)break;f=b[a+2];"fjs"==q&&"@"==f?(a+=3,d="FusionEndTagOpen"):y(f)?(a+=2,d="HTMLEndTagOpen"):(a+=2,d="HTMLBogusCommentOpen");break}else if("fjs"==q&&"@"==f){if(a!=l)break;a+=2;d="FusionStartTagOpen";break}else if("!"==f){if(a!=l)break;f=b[a+2];">"==f?(a+=2,d="HTMLBogusCommentOpen"):"fjs"==q&&"@"==f?(a+=3,d="FusionDirectiveTagOpen"):"-"==f&&"-"==b[a+3]?(a+=4,d="HTMLCommentOpen"):(f=b.substr(a+2,7),"DOCTYPE"==f?(a+=9,d="HTMLDOCTYPEOpen"):"[CDATA["==f?(a+=9,d="HTMLCDATAOpen"):(a+=2,d="HTMLBogusCommentOpen"));
break}else{if("?"==f){if(a!=l)break;a+=2;d="HTMLBogusCommentOpen";break}}else if("&"==c){c=null;f=b[a+1];if("#"==f)if(f=b[a+2],"x"==f||"X"==f){if(f=b[a+3],w(f)){if(a!=l)break;a+=4;c=w}}else{if(u(f)){if(a!=l)break;a+=3;c=u}}else if(y(f)){if(a!=l)break;a+=2;c=J}if(c){for(d="HTMLCharacterReference";c(b[a]);)a++;";"!=b[a++]&&a--;break}}else if("fjs"==q&&"$"==c&&"{"==b[a+1]&&g&&"<"==g.state){if(a!=l)break;a+=2;d="FusionSubstitutionOpen";t=new v("<${");break}while(++a<e);break;case "HTMLStartTagOpen":case "HTMLEndTagOpen":if(y(b[a])){a++;
d="HTMLStartTagOpen"!=d?"HTMLEndTagName":"HTMLStartTagName";do if(c=b[a],">"==c||"/"==c||z(c))break;while(++a<e);g&&(g.tag=b.substring(l,a));break}case "HTMLEndTagName":case "HTMLEndTagText":case "HTMLEndTagWhitespace":f="HTMLStartTagOpen"!=d;case "HTMLStartTagName":case "HTMLStartTagSolidus":case "HTMLStartTagWhitespace":case "HTMLAttributeName":case "HTMLAttributeOperator":case "HTMLAttributeValue":case "HTMLAttributeDoubleQuotedValue":case "HTMLAttributeSingleQuotedValue":case "FusionAttributeTemplateString":case "FusionAttributeTemplateStringTail":c=
b[a];if(">"==c){if(a++,d=f?"HTMLEndTagClose":"HTMLStartTagClose",g){(e=f)||(e=g.tag,e="area"==e||"base"==e||"br"==e||"col"==e||"embed"==e||"hr"==e||"img"==e||"input"==e||"keygen"==e||"link"==e||"menuitem"==e||"meta"==e||"param"==e||"source"==e||"track"==e||"wbr"==e);e&&C(g,c);if("fjs"!=q&&!f&&"script"==g.tag||"style"==g.tag)t=new v("<"+g.tag);g.tag=""}}else if(z(c))for(a++,d=f?"HTMLEndTagWhitespace":"HTMLStartTagWhitespace";z(b[a]);)a++;else if(f){a++;d="HTMLEndTagText";do if(c=b[a],">"==c||z(c))break;
while(++a<e)}else if("="==c&&h&&"HTMLAttributeName"==h.type)a++,d="HTMLAttributeOperator";else if(h&&"HTMLAttributeOperator"==h.type){h='"'==c||"'"==c||"`"==c&&"fjs"==q&&g&&"<"==g.state?c:null;a++;d="`"==h?"FusionAttributeTemplateString":'"'==h?"HTMLAttributeDoubleQuotedValue":"'"==h?"HTMLAttributeSingleQuotedValue":"HTMLAttributeValue";do if(c=b[a],h)if(c==h){a++;break}else{if("`"==h&&"$"==c&&"{"==b[a+1]){a+=2;d="FusionAttributeTemplateStringHead";t=new v("=`${");break}}else if(">"==c||z(c))break;
while(++a<e)}else if("/"==c)if(c=b[++a],d="HTMLStartTagSolidus",">"==c)a++,d="HTMLStartTagSelfClose",g&&(C(g,c),g.tag="");else for(;"/"==c;)c=b[++a];else{a++;d="HTMLAttributeName";do if(c=b[a],">"==c||"/"==c||"="==c||z(c))break;while(++a<e)}break;case "HTMLCommentOpen":d="HTMLCommentText";case "HTMLCommentText":do if(c=b[a],">"==c){if(a==l&&h&&"HTMLCommentOpen"==h.type){a++;d="HTMLCommentClose";break}}else if("-"==c)if(f=b[a+1],">"==f){if(a==l&&h&&"HTMLCommentOpen"==h.type){a+=2;d="HTMLCommentClose";
break}}else if("-"==f&&(f=b[a+2],">"==f||"!"==f&&">"==b[a+3])){if(a!=l)break;a+="!"==f?4:3;d="HTMLCommentClose";break}while(++a<e);break;case "HTMLBogusCommentOpen":d="HTMLBogusCommentText";case "HTMLBogusCommentText":do if(">"==b[a]){if(a!=l)break;a++;d="HTMLBogusCommentClose";break}while(++a<e);break;case "HTMLDOCTYPEOpen":case "HTMLDOCTYPEString":case "HTMLDOCTYPEDoubleQuotedString":case "HTMLDOCTYPESingleQuotedString":case "HTMLDOCTYPEWhitespace":c=b[a];if(">"==c)a++,d="HTMLDOCTYPEClose";else if(z(c))for(a++,
d="HTMLDOCTYPEWhitespace";z(b[a]);)a++;else{h='"'==c||"'"==c?c:null;a++;d='"'==c?"HTMLDOCTYPEDoubleQuotedString":"'"==c?"HTMLDOCTYPESingleQuotedString":"HTMLDOCTYPEString";do if(c=b[a],h){if(c==h){a++;break}}else if(">"==c||z(c))break;while(++a<e)}break;case "HTMLCDATAOpen":d="HTMLCDATAText";case "HTMLCDATAText":do if("]"==b[a]&&"]"==b[a+1]&&">"==b[a+2]){if(a!=l)break;a+=3;d="HTMLCDATAClose";break}while(++a<e);break;case "css":case "fcss":case "CSSIdentifier":case "CSSNumber":case "CSSDelimiter":case "CSSPunctuator":case "CSSDimension":case "CSSPercentage":case "CSSComma":case "CSSColon":case "CSSSemicolon":case "CSSDoubleQuotedString":case "CSSSingleQuotedString":case "CSSHash":case "CSSFunction":case "CSSAtKeyword":case "CSSMatch":case "CSSUrl":case "CSSColumn":case "CSSUnicodeRange":case "CSSComment":case "CSSWhitespace":case "FusionObject":case "FusionSelector":case "FusionObjectSubstitutionClose":case "FusionSelectorSubstitutionClose":case "FusionStyleSubstitutionClose":c=
b[a];h=u(c);h||"+"!=c&&"-"!=c&&"."!=c||(f=b[a+1],h=u(f)||"."!=c&&"."==f&&u(b[a+2]));if(h){d="CSSNumber";if("."!=c){for(a++;u(b[a]);)a++;c=b[a]}if("."==c&&u(b[a+1])){for(a+=2;u(b[a]);)a++;c=b[a]}f=b[a+1];if(("e"==c||"E"==c)&&(u(f)||("+"==f||"-"==f)&&u(b[a+2]))){for(a+="+"==f||"-"==f?3:2;u(b[a]);)a++;c=b[a]}if("%"==c){a++;d="CSSPercentage";break}else if(!y(c)&&"_"!=c&&"\\"!=c&&"-"!=c&&"\u0080">c)break}if(h||y(c)||"_"==c||"\\"==c||"#"==c||"@"==c||"-"==c||"\u0080"<=c)if(h||"u"!=c&&"U"!=c||"+"!=b[a+1]||
!w(b[a+2])&&"?"!=b[a+2]){d=h?"CSSDimension":"#"==c?"CSSHash":"@"==c?"CSSAtKeyword":"CSSIdentifier";if("\\"==c){if(B(b[a+1])){h||a++;d=h?"CSSNumber":"CSSDelimiter";break}++a<e&&a++}else if("#"==c||"@"==c||"-"==c)if(f=b[a+1],y(f)||"_"==f||"-"==f||"\\"==f&&!B(b[a+2])||!("\u0080">f)||"#"==c&&u(f))if("@"==c&&"-"==f){f=b[a+2];if(!y(f)&&"_"!=f&&"-"!=f&&("\\"!=f||B(b[a+3]))&&"\u0080">f){a++;d="CSSDelimiter";break}a+=3}else a+=2;else{h||a++;d=h?"CSSNumber":"CSSDelimiter";break}else a++;do if(c=b[a],"\\"==
c){if(B(b[a+1]))break;if(++a>=e)break}else if(!J(c)&&"_"!=c&&"-"!=c&&"\u0080">c)break;while(++a<e);if("("==c&&"CSSIdentifier"==d&&(a++,d="CSSFunction",g&&C(g,c),a==l+4&&"url"==b.substr(l,3).toLowerCase())){for(c=0;z(b[a+c]);)c++;f=b[a+c];if('"'!=f&&"'"!=f){a+=c;d="CSSUrl";do if(c=b[a],")"==c){a++;break}else if("\\"==c&&++a>=e)break;while(++a<e)}}}else{a+=2;d="CSSUnicodeRange";for(c=0;6>c&&w(b[a+c]);)c++;f=b[a+c];if("-"==f&&w(b[a+c+1]))for(a+=c+1,c=0;6>c&&w(b[a+c]);)c++;else if("?"==f)for(;6>c&&"?"==
b[a+c];)c++;a+=c}else if("/"==c&&"*"==b[a+1]){a+=2;d="CSSComment";do if("*"==b[a]&&"/"==b[a+1]){a+=2;break}while(++a<e)}else if(z(c))for(a++,d="CSSWhitespace";z(b[a]);)a++;else if('"'==c||"'"==c){h=c;a++;d='"'==h?"CSSDoubleQuotedString":"CSSSingleQuotedString";do if(c=b[a],"\\"==c){if(++a>=e)break;"\r"==b[a]&&"\n"==b[a+1]&&a++}else if(c==h){a++;break}else if(B(c))break;while(++a<e)}else if("$"==c||"*"==c||"^"==c||"|"==c||"~"==c)f=b[a+1],"fjs"!=q||"$"!=c||"{"!=f||!g||"@{:"!=g.state&&"@("!=g.state&&
"@["!=g.state&&"<style"!=g.state?"|"==c&&"|"==f?(a+=2,d="CSSColumn"):"="==f?(a+=2,d="CSSMatch"):(a++,d="CSSDelimiter"):(a+=2,d="@{:"==g.state?"FusionObjectSubstitutionOpen":"@("==g.state||"@["==g.state?"FusionSelectorSubstitutionOpen":"FusionStyleSubstitutionOpen",t=new v(g.state+c+f));else if("("==c||")"==c||"["==c||"]"==c||"{"==c||"}"==c)a++,d="CSSPunctuator",g&&C(g,c);else if(","==c)a++,d="CSSComma";else if(":"==c)a++,d="CSSColon",g&&"@{"==g.state&&(m=c);else if(";"==c)a++,d="CSSSemicolon",g&&
"@{:"==g.state&&(s="@{");else if("<"==c)if(c=b[++a],d="CSSDelimiter","!"==c&&"-"==b[a+1]&&"-"==b[a+2]&&g&&"<style"==g.state){a+=3;d="CSSComment";do if("-"==b[a]&&"-"==b[a+1]&&">"==b[a+2]){a+=3;break}while(++a<e)}else"/"==c&&"style"==b.substr(a+1,5)&&g&&"<style"==g.state&&(a++,d="HTMLEndTagOpen",m=">",p=!0);else a++,d="CSSDelimiter";break;default:return null}this.position=a;this.state=d;"fjs"==q&&g&&"<"==g.state&&0==g.tags?(m=">",p=!0,this.state=q):"fjs"==q&&g&&(("@{"==g.state||"@{:"==g.state)&&0==
g.braces||"@("==g.state&&0==g.parentheses||"@["==g.state&&0==g.brackets)?(p=!0,s="@("==g.state?"@()":"@["==g.state?"@[]":"@{}",this.state=q):t&&"HTMLStartTagClose"==d&&("<script"==t.state?this.state="js":"<style"==t.state&&(this.state="css"));g&&(s&&(g.state=s),m&&(g.state+=m));k&&(t?p&&r?k[r-1]=t:k.push(t):p&&k.pop());if(a==l)return null;h=new P(d,b,l,a);F(d)||N(d)||(this.expression=g&&p?g.state:"",this.token=h);return h},!0);s(n,"peek",function(b,e){var l=new K;l.language=this.language;l.position=
b||this.position;l.source=this.source;l.state=e||this.state;for(var h=l.next();h;){var n=h.type;if(!F(n)&&!N(n))break;h=l.next()}return h},!0);s(n,"reset",function(){this.chain="fjs"!=this.language&&"js"!=this.language?[new v("")]:[];this.expression="";this.position=0;this.state="";this.token=null},!0);(function(){}.prototype={}).lexer=null;var v=function(b){this.state=b},n=v.prototype={};n.braces=0;n.brackets=0;n.parentheses=0;n.state="";n.tag="";n.tags=0;s(n,"clone",function(){var b=new v(this.state);
b.braces=this.braces;b.brackets=this.brackets;b.parentheses=this.parentheses;b.state=this.state;b.tag=this.tag;b.tags=this.tags;return b},!0);s(n,"equals",function(b){return this.braces===b.braces&&this.brackets===b.brackets&&this.parentheses===b.parentheses&&this.state===b.state&&this.tag===b.tag&&this.tags===b.tags},!0);var P=function(b,e,l,h){this.type=b;this.source=e;this.start=l;this.end=h},n=P.prototype={};n.end=0;n.source="";n.start=0;n.type="";s(n,"clone",function(){return new P(this.type,
this.source,this.start,this.end)},!0);s(n,"equals",function(b){return this.type===b.type&&this.text()===b.text()},!0);s(n,"html",function(){var b=this.text().replace(aa,ba);return!this.type||F(this.type)||U(this.type)?b:'<span class="fusion_'+this.type+'">'+b+"</span>"},!0);s(n,"node",function(){if(!this.type||F(this.type)||U(this.type))return document.createTextNode(this.text());var b=document.createElement("span");this.type&&b.setAttribute("class","fusion_"+this.type);b.innerText=this.text();return b},
!0);s(n,"text",function(){return this.source.substring(this.start,this.end)},!0);G("highlight",function(b,e){for(var l=new K(b,e),h="",n=null,q=null,a=null;q=l.next();)if(x(q.type,"CSS")){null==a&&(a=[]);n&&(x(n.type,"CSS")||"FusionObjectSubstitutionClose"==n.type||"FusionSelectorSubstitutionClose"==n.type||"FusionStyleSubstitutionClose"==n.type)||a.unshift("*");var d=q.type;if(F(d))h+=q.html();else{var k=a[0],r=null,g="CSSPunctuator"==d?q.text():null;if("{"==g)"*"!=k&&"@"!=k?(k="*{",a.unshift(k)):
a[0]+=g;else if("}"==g)"*{"==k||"*{:"==k?1<a.length?a.shift():a[0]="*":"@{"!=k&&"@{:"!=k||a.shift();else if("CSSSemicolon"==d)if("@"==k)a.shift();else{if("*{:"==k||"@{:"==k)a[0]=k[0]+"{"}else if("CSSColon"!=d||"*{"!=k&&"@{"!=k){if("CSSAtKeyword"!=d||"*"!=k&&"*{"!=k&&"@{"!=k||(k="@",a.unshift(k)),g="@{"==k&&"CSSIdentifier"==d?l.peek(q.end):null,r="*{"==k&&"CSSIdentifier"==d||g&&"CSSColon"==g.type?"CSSDeclarationName":"*{:"==k||"@{:"==k?"CSSDeclarationValue":"*"==k||"@{"==k?"CSSSelector":"@"==k?"CSSAtRule":
null,"*{:"==k||"@{:"==k)"CSSDelimiter"==d&&"!"==q.text()?(g=l.peek(q.end))&&"CSSIdentifier"==g.type&&"important"==g.text().toLowerCase()&&(g=l.peek(g.end))&&("CSSSemicolon"==g.type||"CSSPunctuator"==g.type&&"}"==g.text())&&(r="CSSDeclarationImportant"):n&&"CSSDelimiter"==n.type&&"!"==n.text()&&"CSSIdentifier"==d&&"important"==q.text().toLowerCase()&&(g=l.peek(q.end))&&("CSSSemicolon"==g.type||"CSSPunctuator"==g.type&&"}"==g.text())&&(r="CSSDeclarationImportant")}else a[0]+=":";r?(n=q.clone(),n.type=
r,h+=n.html()):h+=q.html();n=l.token}}else h+=q.html(),n=l.token;return h});G("transpile",function(b,e,l,h,n,q){b=new K(b,"fjs");for(var a="",d=null,k=null,r=[],g=function(a,b){return b.toUpperCase()};d=b.next();){if("FusionSelector"==d.type||"FusionSelectorSubstitutionClose"==d.type){for(var m="",f="FusionSelector"==d.type,p=!0;d=b.next();)if("FusionSelectorSubstitutionOpen"==d.type)m+='".concat(',p=!1;else if("FusionSelectorSubstitutionClose"==d.type)m+=')+"',p=!0;else{if(!x(d.type,"CSS"))break;
N(d.type)||(m+=d.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n"),k=b.token)}var s=/^\(\s*(head|html|body)\s*\)$/i.exec(m);s?(m=s[1].toLowerCase(),a+="document."+("html"==m?"documentElement":m)):(a+=f?"["==m[0]?(h||"document.__query")+'("':(l||"document.__find")+'("':')+"',a+=m.substr(f?1:0,m.length-(f&&p?2:1)),p&&(a+='")'))}else if("FusionObject"==d.type||"FusionObjectSubstitutionClose"==d.type)for((m="FusionObject"!=d.type)&&(a+=')+"');d=b.next();)if("FusionObjectSubstitutionOpen"==
d.type)k&&"CSSColon"==k.type&&(a+='"'),a+='".concat(';else if("FusionObjectSubstitutionClose"==d.type)a+=')+"';else{if(!x(d.type,"CSS"))break;if(!N(d.type)){if(f=F(d.type)?d:null)if(d=b.next(),!d){a+=f.text();break}if(m){if("CSSPunctuator"==d.type&&"}"==d.text()&&"fjs"==b.state){k&&"CSSSemicolon"==k.type||(a+='"');f&&(a+=f.text());a+=d.text();continue}else if("CSSSemicolon"==d.type){a+='"';m=!1;f&&(a+=f.text());k=b.token;continue}else f&&(a+=f.text().replace(/\n/g,"\\n\\\n"));a="FusionObjectSubstitutionOpen"==
d.type?a+'".concat(':"FusionObjectSubstitutionClose"==d.type?a+')+"':a+d.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"')}else"CSSIdentifier"==d.type&&k&&("CSSPunctuator"==k.type&&"{"==k.text()||"CSSSemicolon"==k.type)?("CSSSemicolon"==k.type&&(a+=","),f&&(a+=f.text()),a+='"',a+=d.text().replace(/^-+/,"").replace(/-+([a-z])/ig,g),a+='"'):"CSSColon"==d.type?(f&&(a+=f.text()),a+=d.text()):"CSSSemicolon"==d.type?f&&(a+=f.text()):k&&"CSSColon"==k.type?(f&&(a+=f.text()),m=!0,"fjs"!=b.state&&(a+='"'),a=
"FusionObjectSubstitutionOpen"==d.type?a+'".concat(':"FusionObjectSubstitutionClose"==d.type?a+')+"':a+d.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"')):(f&&(a+=f.text()),a+=d.text());k=b.token}}if(!d)break;if("FusionProperty"==d.type)a+=".__"+d.text().substr(1);else if("FusionSubstitutionOpen"==d.type||"FusionStyleSubstitutionOpen"==d.type)a+='".concat(';else if("FusionSubstitutionClose"==d.type||"FusionStyleSubstitutionClose"==d.type)a+=')+"';else if("HTMLStartTagOpen"==d.type)r.length&&(a+=d.text());
else if("HTMLStartTagName"==d.type)m=d.text(),r.push(m),m=m.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),a+=1<r.length?m:(e||"document.__create")+'("'+m+'")';else if(r.length)if("HTMLStartTagClose"==d.type)!k||"HTMLAttributeName"!=k.type&&"HTMLAttributeOperator"!=k.type?!k||"JavaScriptTemplateString"!=k.type&&"FusionAttributeTemplateString"!=k.type&&"FusionAttributeTemplateStringTail"!=k.type||(a+=")"):a+='"")',m=r[r.length-1],"area"==m||"base"==m||"br"==m||"col"==m||"embed"==m||"hr"==m||"img"==m||"input"==
m||"keygen"==m||"link"==m||"menuitem"==m||"meta"==m||"param"==m||"source"==m||"track"==m||"wbr"==m?(r.pop(),r.length&&(a+=d.text())):a+=1<r.length?d.text():"."+(q||"__html")+'("';else if("HTMLEndTagOpen"==d.type)a+=1<r.length?d.text():'")';else if("HTMLEndTagName"==d.type){m=d.text();if(m!=r[r.length-1])throw"unmatched <"+r[r.length-1]+"> tag";1<r.length&&(a+=m.replace(/\\/g,"\\\\").replace(/"/g,'\\"'))}else if("HTMLStartTagSelfClose"==d.type||"HTMLEndTagClose"==d.type||"HTMLEndTagSelfClose"==d.type)"HTMLStartTagSelfClose"==
d.type&&k&&"HTMLAttributeName"==k.type?a+='"")':"HTMLStartTagSelfClose"!=d.type||!k||"JavaScriptTemplateString"!=k.type&&"FusionAttributeTemplateString"!=k.type&&"FusionAttributeTemplateStringTail"!=k.type||(a+=")"),r.pop(),r.length&&(a+=d.text());else if(1==r.length&&"HTMLAttributeName"==d.type)k&&"HTMLAttributeName"==k.type?a+='"")':!k||"JavaScriptTemplateString"!=k.type&&"FusionAttributeTemplateString"!=k.type&&"FusionAttributeTemplateStringTail"!=k.type||(a+=")"),a+="."+(n||"__attr")+'("',a+=
d.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"'),a+='",';else if(1==r.length&&("HTMLAttributeValue"==d.type||"HTMLAttributeDoubleQuotedValue"==d.type||"HTMLAttributeSingleQuotedValue"==d.type)){k=d.text();"HTMLAttributeValue"!=d.type&&(k=k.substr(1,k.length-2));a+='"';d=0;for(m=k.length;d<m;){f=k[d];if("&"==f)if(p=k[d+1],"#"==p)if(p=k[d+2],"x"==p||"X"==p){if(p=k[d+3],w(p)){d+=3;p="";do{f=k[d];if(!w(f))break;p+=f}while(++d<m);for(";"!=k[d++]&&d--;4>p.length;)p="0"+p;a+="\\u";a+=p;continue}}else{if("0"<=
p&&"9">=p){d+=2;p="";do{f=k[d];if("0">f||"9"<f)break;p+=f}while(++d<m);";"!=k[d++]&&d--;for(p=Z(p,10).toString(16);4>p.length;)p="0"+p;a+="\\u";a+=p;continue}}else{if(y(p)){d++;p="&";do{f=k[d];if(!J(f))break;p+=f}while(++d<m);";"!=k[d++]?d--:p+=";";f=M[p.substr(1)];R(f)?f="\\u"+O(f[0],4,"0")+"\\u"+O(f[1],4,"0"):f&&(f="\\u"+O(f,4,"0"));a+=f?f:p;continue}}else if('"'==f){a+='\\"';d++;continue}else if("\n"==f){a+="\\n\\\n";d++;continue}else if("\\"==f){a+="\\\\";d++;continue}a+=f;d++}a+='")'}else if(1==
r.length&&"HTMLStartTagSolidus"==d.type)k&&"HTMLAttributeName"==k.type?a+='"")':!k||"JavaScriptTemplateString"!=k.type&&"FusionAttributeTemplateString"!=k.type&&"FusionAttributeTemplateStringTail"!=k.type||(a+=")");else if("JavaScriptTemplateString"==d.type||"FusionAttributeTemplateString"==d.type||"FusionAttributeTemplateStringHead"==d.type||"FusionAttributeTemplateStringMiddle"==d.type||"FusionAttributeTemplateStringTail"==d.type)k=d.text(),d="`"==k[0],m="`"==k[k.length-1],a+=d?'"':')+"',a+=k.substr(1,
m?k.length-2:k.length-3).replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n"),a+=m?'"':'".concat(';else if("HTMLText"==d.type||x(d.type,"CSS"))a+=d.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n");else if("HTMLStartTagWhitespace"==d.type)a+=k&&"HTMLAttributeOperator"==k.type?d.text():d.text().replace(/^[^\r\n]+/,"");else{if(1<r.length||"HTMLEndTagText"!=d.type&&"HTMLEndTagSolidus"!=d.type&&"HTMLAttributeOperator"!=d.type)a+=d.text()}else"JavaScriptTemplateString"==d.type?(k=d.text(),
d="`"==k[0],m="`"==k[k.length-1],a+=d?'"':')+"',a+=k.substr(1,m?k.length-2:k.length-3).replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n"),a+=m?'"':'".concat('):a+=d.text();k=b.token}if(r.length)throw"unmatched <"+r[r.length-1]+"> tag";return a});"function"==typeof define&&define.amd?define(function(){return D}):"undefined"!=typeof module&&null!=module&&module.exports?module.exports=D:function(b){var e=E.f_Shorthand,l=E.f_Writable;"string"!=typeof e&&(e=!0===e?"f":"");"boolean"!=typeof l&&(l="undefined"!=
typeof E.intellisense);!b||Y.call(b,"fusion")&&!l||(e&&s(b,e,D,l),s(b,"fusion",D,l))}(H.window===H?H:E)})(this);