/*! ------------------------------------------------------------------------
//                                   Fusion
//  ------------------------------------------------------------------------
//
//                       Copyright 2014 Nicholas Gaulin
//
//       Licensed under the Apache License, Version 2.0 (the "License");
//      you may not use this file except in compliance with the License.
//                   You may obtain a copy of the License at
//
//                 http://www.apache.org/licenses/LICENSE-2.0
//
//     Unless required by applicable law or agreed to in writing, software
//      distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//     See the License for the specific language governing permissions and
//                       limitations under the License.
*/
(function(F,fa){F||(F={});var s=Object,E=s.create,Q=s.defineProperty,I=s.freeze,V=s.getPrototypeOf,m=s.keys,W=s.preventExtensions,X=s.seal,Y=s.prototype.hasOwnProperty,M=Array,s=M.prototype,R=M.isArray,M=Error,Z=parseInt,$=String.prototype;if(!(E&&Q&&I&&V&&W&&X&&R&&s.forEach&&s.indexOf&&$.trim))throw new M("JavaScript engine does not support ECMAScript 5.");var I="undefined"!=typeof window&&null!=window&&window.window===window?window:{},N={Aacute:"C1",aacute:"E1",Acirc:"C2",acirc:"E2",acute:"B4",
AElig:"C6",aelig:"E6",Agrave:"C0",agrave:"E0",amp:"26",AMP:"26",Aring:"C5",aring:"E5",Atilde:"C3",atilde:"E3",Auml:"C4",auml:"E4",brvbar:"A6",Ccedil:"C7",ccedil:"E7",cedil:"B8",cent:"A2",copy:"A9",COPY:"A9",curren:"A4",deg:"B0",divide:"F7",Eacute:"C9",eacute:"E9",Ecirc:"CA",ecirc:"EA",Egrave:"C8",egrave:"E8",ETH:"D0",eth:"F0",Euml:"CB",euml:"EB",frac12:"BD",frac14:"BC",frac34:"BE",gt:"3E",GT:"3E",Iacute:"CD",iacute:"ED",Icirc:"CE",icirc:"EE",iexcl:"A1",Igrave:"CC",igrave:"EC",iquest:"BF",Iuml:"CF",
iuml:"EF",laquo:"AB",lt:"3C",LT:"3C",macr:"AF",micro:"B5",middot:"B7",nbsp:"A0",not:"AC",Ntilde:"D1",ntilde:"F1",Oacute:"D3",oacute:"F3",Ocirc:"D4",ocirc:"F4",Ograve:"D2",ograve:"F2",ordf:"AA",ordm:"BA",Oslash:"D8",oslash:"F8",Otilde:"D5",otilde:"F5",Ouml:"D6",ouml:"F6",para:"B6",plusmn:"B1",pound:"A3",quot:"22",QUOT:"22",raquo:"BB",reg:"AE",REG:"AE",sect:"A7",shy:"AD",sup1:"B9",sup2:"B2",sup3:"B3",szlig:"DF",THORN:"DE",thorn:"FE",times:"D7",Uacute:"DA",uacute:"FA",Ucirc:"DB",ucirc:"FB",Ugrave:"D9",
ugrave:"F9",uml:"A8",Uuml:"DC",uuml:"FC",Yacute:"DD",yacute:"FD",yen:"A5",yuml:"FF"},aa=/[<>&'"]/g;m(N).forEach(function(b,e,l){N[b+";"]=N[b]});var r=function(b,e,l,k,m,q){Q(b,e,{configurable:!!q,enumerable:!!m,value:l,writable:!!k})},m="ABCDEFGHIJKLMNOPQRSTUVWXYZ";E(null);var m=m+m.toLowerCase(),J=function(b,e,l){if(!e||!b||e.length>b.length)return!1;if(!l||l>b.length)l=b.length;return e==b.substr(l-e.length)},ba=function(b){return"&#"+b.charCodeAt(0)+";"},O=function(b,e,l){for(l||(l=" ");b.length<
e;)b=l+b;return b},y=function(b,e,l){if(!e||!b||e.length>b.length)return!1;if(!l||0>l)l=0;return e==b.substr(l,e.length)},K=function(b){return"a"<=b&&"z">=b||"A"<=b&&"Z">=b||"0"<=b&&"9">=b},ca=function(b){return"0"==b||"1"==b},x=function(b){return"a"<=b&&"f">=b||"A"<=b&&"F">=b||"0"<=b&&"9">=b},z=function(b){return"a"<=b&&"z">=b||"A"<=b&&"Z">=b},B=function(b){return"\r"==b||"\n"==b||"\u2028"==b||"\u2029"==b},u=function(b){return"0"<=b&&"9">=b},da=function(b){return"0"<=b&&"7">=b},A=function(b){return" "==
b||"\r"==b||"\n"==b||"\t"==b||"\f"==b},S=function(b){return"\t"==b||"\v"==b||"\f"==b||" "==b||"\u00a0"==b||"\ufeff"==b},E=function(b,e){if(0<=b.indexOf(" "))for(var l=b.split(" "),k=0,m=l.length;k<m;k++)r(D,l[k],e);else r(D,b,e)},D=function(){};r(D,"dev",!1,void 0,!0);r(D,"version","1.0.0b",void 0,!0);var G=function(b,e){b&&(this.source=b);e&&(this.language=e,this.chain="fhtml"==e?[new v]:"fjs"==e||"fcss"==e?[]:null)},m=G.prototype={},ea=function(b,e,l){return b.clone()},L=function(b){return"JavaScriptBlockComment"==
b||"JavaScriptLineComment"==b||"HTMLCommentOpen"==b||"HTMLCommentText"==b||"HTMLCommentClose"==b||"HTMLBogusCommentOpen"==b||"HTMLBogusCommentText"==b||"HTMLBogusCommentClose"==b||"CSSComment"==b},C=function(b,e){if("{"==e||"}"==e)b.braces+="{"==e?1:b.braces?-1:0;else if("("==e||")"==e)b.parentheses+="("==e?1:b.parentheses?-1:0;else if("["==e||"]"==e)b.brackets+="["==e?1:b.brackets?-1:0;else if("<"==e||">"==e)b.tags+="<"==e?1:b.tags?-1:0},T=function(b,e){if(!b)return!0;var l=b.type;return"JavaScriptPunctuator"==
l?(l=b.text(),(")"!=l||e&&("for()"==e||"if()"==e||"while()"==e||"with()"==e))&&("}"!=l||!e||"{}"!=e)&&"]"!=l&&"++"!=l&&"--"!=l):"JavaScriptReservedWord"==l?(l=b.text(),"case"==l||"delete"==l||"do"==l||"else"==l||"extends"==l||"in"==l||"instanceof"==l||"new"==l||"return"==l||"throw"==l||"typeof"==l||"void"==l||"yield"==l):"JavaScriptTemplateString"==l?"`"!=b.source.substr(b.end-1,1):"FusionAttributeTemplateStringHead"==l||"FusionAttributeTemplateStringMiddle"==l||"FusionSubstitutionOpen"==l||"FusionObjectSubstitutionOpen"==
l||"FusionSelectorSubstitutionOpen"==l||"FusionStyleSubstitutionOpen"==l},U=function(b){return"JavaScriptInvalidCharacter"==b||"HTMLText"==b||"HTMLEndTagText"==b},H=function(b){return"JavaScriptWhitespace"==b||"HTMLStartTagWhitespace"==b||"HTMLEndTagWhitespace"==b||"HTMLDOCTYPEWhitespace"==b||"CSSWhitespace"==b};m.chain=null;m.expression="";m.language="";m.position=0;m.source="";m.state="";m.token=null;r(m,"clone",function(){var b=new G;b.chain=this.chain?this.chain.map(ea):null;b.expression=this.expression;
b.language=this.language;b.position=this.position;b.source=this.source;b.state=this.state;b.token=this.token?this.token.clone():null;return b},!0);r(m,"equals",function(b){var e=b.chain,l=this.chain;if((l&&l.length||0)!=(e&&e.length||0))return!1;if(l)for(var k=0,m=l.length;k<m;k++)if(!l[k].equals(e[k]))return!1;return!this.token!=!b.token||this.token&&!this.token.equals(b.token)?!1:this.expression===b.expression&&this.language===b.language&&this.state===b.state},!0);r(m,"hack",function(){if(this.chain)return!1;
var b=this.language;this.chain="html"==b||"fhtml"==b?[new v]:"js"==b||"fjs"==b||"fcss"==b?[]:null;return!!this.chain},!0);r(m,"next",function(){var b=this.source,e=b.length,l=this.position,k=this.token,m=this.expression,q=this.language,a=this.position,d=this.state||q,h="fjs"==q||"fhtml"==q||"fcss"==q,n=this.chain,r=n?n.length:0,f=r?n[r-1]:null;if(0>a||a>=e)return null;var p="",g=!1,w=!1,t=null,s="";switch(d){case "js":case "fjs":case "JavaScriptIdentifier":case "JavaScriptReservedWord":case "JavaScriptPunctuator":case "JavaScriptNumber":case "JavaScriptDoubleQuotedString":case "JavaScriptSingleQuotedString":case "JavaScriptTemplateString":case "JavaScriptRegExp":case "JavaScriptBlockComment":case "JavaScriptLineComment":case "JavaScriptInvalidCharacter":case "JavaScriptWhitespace":case "FusionStartTagOpen":case "FusionEndTagOpen":case "FusionDirectiveTagOpen":case "FusionProperty":case "FusionAttributeTemplateStringHead":case "FusionAttributeTemplateStringMiddle":case "FusionSubstitutionOpen":case "FusionObjectSubstitutionOpen":case "FusionSelectorSubstitutionOpen":case "FusionStyleSubstitutionOpen":var c=
b[a];if(z(c)||"_"==c||"$"==c||"\\"==c||"@"==c&&h&&k&&("JavaScriptIdentifier"==k.type||!("JavaScriptPunctuator"!=k.type&&"CSSPunctuator"!=k.type||")"!=b[k.start]&&"]"!=b[k.start]))){"\\"!=c&&a++;d="@"==c?"FusionProperty":"JavaScriptIdentifier";do if(c=b[a],!K(c)&&"_"!=c&&"$"!=c&&"\u200c"!=c&&"\u200d"!=c){if("\\"!=c)break;g=b[a+1];if("u"!=g)break;g=b[a+2];if("{"==g){for(c=0;x(b[a+c+3]);)c++;if(c&&"}"==b[a+c+3])a+=c+3;else break}else if(x(g)&&x(b[a+3])&&x(b[a+4])&&x(b[a+5]))a+=5;else break}while(++a<
e);a==l?(a++,d="JavaScriptInvalidCharacter"):k&&"JavaScriptPunctuator"==k.type&&"."==k.text()||h&&"FusionProperty"==d||((e=b.substring(l,a),h&&k&&("FusionStartTagOpen"==k.type&&("break"==e||"case"==e||"continue"==e||"default"==e||"do"==e||"else"==e||"for"==e||"if"==e||"switch"==e||"while"==e)||"FusionEndTagOpen"==k.type&&"while"==e))?(d="JavaScriptReservedWord",t=new v("FusionEndTagOpen"==k.type?"</@"+e:"<@"+e)):"null"==e||"false"==e||"true"==e||"break"==e||"case"==e||"catch"==e||"class"==e||"const"==
e||"continue"==e||"debugger"==e||"default"==e||"delete"==e||"do"==e||"else"==e||"enum"==e||"export"==e||"extends"==e||"finally"==e||"for"==e||"function"==e||"if"==e||"implements"==e||"import"==e||"in"==e||"instanceof"==e||"interface"==e||"let"==e||"new"==e||"package"==e||"private"==e||"protected"==e||"public"==e||"return"==e||"static"==e||"super"==e||"switch"==e||"this"==e||"throw"==e||"try"==e||"typeof"==e||"var"==e||"void"==e||"while"==e||"with"==e||"yield"==e?((k=k&&"JavaScriptReservedWord"==k.type?
k.text():null)&&("get"==k||"set"==k)||f&&"{"==f.state||(d="JavaScriptReservedWord"),h&&"else"==k&&f&&"<@else"==f.state&&("do"==e||"for"==e||"if"==e||"switch"==e||"while"==e)&&(p=" "+e)):"get"!=e&&"set"!=e||!f||"{"!=f.state||(e=(g=this.peek(a))?g.type:null,"JavaScriptIdentifier"!=e&&"JavaScriptReservedWord"!=e)||(e=(g=this.peek(g.end))?g.type:null,"JavaScriptPunctuator"==e&&"("==b[g.start]&&(d="JavaScriptReservedWord",s="{:")))}else if(S(c)||B(c)){a++;d="JavaScriptWhitespace";do if(c=b[a],!S(c)&&!B(c))break;
while(++a<e)}else if('"'==c||"'"==c||"`"==c&&n||"}"==c&&f&&0==f.braces&&J(f.state,"`${"))for(g="}"==c&&"=`${"==f.state,k="}"!=c?c:"`",d=g?"FusionAttributeTemplateStringTail":'"'==k?"JavaScriptDoubleQuotedString":"'"==k?"JavaScriptSingleQuotedString":"JavaScriptTemplateString","}"==c&&(p=c+k,w=!0);++a<e;)if(c=b[a],"\\"==c){if(++a>=e)break;"\r"==b[a]&&"\n"==b[a+1]&&a++}else if(c==k){a++;break}else if("`"==k){if("$"==c&&"{"==b[a+1]){a+=2;t=new v(w?f.state:"`${");g&&(d="FusionAttributeTemplateStringMiddle");
break}}else{if(B(c))break}else if("/"==c)if(g=b[a+1],"*"==g)for(a++,d="JavaScriptBlockComment";++a<e;){if("*"==b[a]&&"/"==b[a+1]){a+=2;break}}else if("/"==g)for(a++,d="JavaScriptLineComment";++a<e&&!B(b[a]););else if(h&&">"==g&&f&&y(f.state,"<@")&&("<@break"==f.state||"<@case"==f.state||"<@continue"==f.state||"<@default"==f.state||"<@else"==f.state))a+=2,d="FusionStartTagSelfClose",p=c+g,w=!0;else if(T(k,m)){d="JavaScriptRegExp";for(g=!1;++a<e;)if(c=b[a],"\\"==c){if(++a>=e||B(b[a]))break}else if(!g&&
"/"==c){a++;break}else if(!g&&"["==c)g=!0;else if(g&&"]"==c)g=!1;else if(B(c))break;if("/"==c&&(c=b[a],z(c)||"_"==c||"$"==c)){a++;do if(c=b[a],!K(c)&&"_"!=c&&"$"!=c&&"\u200c"!=c&&"\u200d"!=c)break;while(++a<e)}}else a++,d="JavaScriptPunctuator","="==b[a]&&a++;else if(u(c)||"."==c&&u(b[a+1]))if(d="JavaScriptNumber",g="0"==c?b[a+1]:null,"0"!=c||"."==g||"e"==g||"E"==g){if("."!=c){for(a++;u(b[a]);)a++;c=b[a]}if("."==c){for(a++;u(b[a]);)a++;c=b[a]}g=b[a+1];if(("e"==c||"E"==c)&&(u(g)||("+"==g||"-"==g)&&
u(b[a+2])))for(a+="+"==g||"-"==g?3:2;u(b[a]);)a++}else{if(a++,(c="b"==g||"B"==g?ca:"o"==g||"O"==g?da:"x"==g||"X"==g?x:null)&&c(b[a+1]))for(a+=2;c(b[a]);)a++}else if("{"==c){if(a++,d="JavaScriptPunctuator",n){e=k&&"JavaScriptReservedWord"==k.type?k.text():null;g=k&&"JavaScriptPunctuator"==k.type?k.text():null;if(e&&"do"!=e&&"else"!=e&&"export"!=e&&"finally"!=e&&"import"!=e&&"try"!=e||g&&"{"!=g&&";"!=g&&"=>"!=g&&"}"!=g)if("("==g||"["==g||","==g||"?"==g||":"==g||"="==g)t=new v("{");else if(!m||!J(m,
"()"))if(e=(g=this.peek(a))?g.type:null,"JavaScriptIdentifier"==e||"JavaScriptReservedWord"==e||"JavaScriptDoubleQuotedString"==e||"JavaScriptSingleQuotedString"==e)k="JavaScriptIdentifier"==e?g.text():null,e=(g=this.peek(g.end))?g.type:null,"JavaScriptPunctuator"==e&&":"==g.text()?t=new v("{"):"get"!=k&&"set"!=k||"JavaScriptIdentifier"!=e&&"JavaScriptReservedWord"!=e||(e=(g=this.peek(g.end))?g.type:null,"JavaScriptPunctuator"==e&&"("==b[g.start]&&(t=new v("{")));f&&!t&&C(f,c)}}else if("}"==c){if(a++,
d="JavaScriptPunctuator",f){if(0==f.braces)if(h&&J(f.state,"${"))d="<${"==f.state?"FusionSubstitutionClose":"@{:${"==f.state?"FusionObjectSubstitutionClose":"@(${"==f.state||"@[${"==f.state?"FusionSelectorSubstitutionClose":"FusionStyleSubstitutionClose",p=c,w=!0;else if("{"==f.state||"{:"==f.state)s="{}",w=!0;w||C(f,c)}}else if("("==c){a++;d="JavaScriptPunctuator";if(h&&f&&(y(f.state,"<@")||y(f.state,"</@"))){if(e=f.state,"<@for"==e||"<@if"==e||"<@switch"==e||"<@while"==e||"<@else for"==e||"<@else if"==
e||"<@else switch"==e||"<@else while"==e||"</@while"==e)p=c}else n&&k&&"JavaScriptReservedWord"==k.type&&(k=k.text(),"catch"==k||"function"==k||"for"==k||"if"==k||"switch"==k||"while"==k||"with"==k)&&(t=new v(k+"("));f&&!t&&C(f,c)}else if(")"==c)a++,d="JavaScriptPunctuator",f&&J(f.state,"(")&&(h&&(y(f.state,"<@")||y(f.state,"</@"))?1==f.parentheses&&(p=c):0==f.parentheses&&(p=c,w=!0)),f&&!w&&C(f,c);else if("["==c||"]"==c)a++,d="JavaScriptPunctuator",f&&C(f,c);else if(":"==c)a++,d="JavaScriptPunctuator",
f&&0==f.braces&&"{"==f.state&&(s="{:");else if(","==c)a++,d="JavaScriptPunctuator",f&&0==f.braces&&"{:"==f.state&&(s="{");else if(";"==c||"?"==c||"~"==c)a++,d="JavaScriptPunctuator";else if("="==c)c=b[++a],d="JavaScriptPunctuator","="==c?"="==b[++a]&&a++:">"==c&&a++;else if("&"==c||"|"==c||"+"==c||"-"==c)g=b[a+1],a+=c==g||"="==g?2:1,d="JavaScriptPunctuator";else if("!"==c||"*"==c||"^"==c||"%"==c)d="JavaScriptPunctuator","="==b[a+1]?(a+=2,"!"==c&&"="==b[a]&&a++):a++;else if("<"==c||">"==c)if(g=b[a+
1],c==g||"="==g)a+=2,d="JavaScriptPunctuator",c==g&&(c=b[a],">"==g&&">"==c&&(c=b[++a]),"="==c&&a++);else if(a++,d="JavaScriptPunctuator",h)if(">"==c&&f&&(y(f.state,"<@")||y(f.state,"</@"))){if(J(f.state,"()")||"<@do"==f.state||"<@else do"==f.state)d=y(f.state,"</@")?"FusionEndTagClose":"FusionStartTagClose",p=c,w=!0}else"<"==c&&"/"==g&&"@"==b[a+1]&&f&&"<@"==f.state?(a+=2,d="FusionEndTagOpen"):">"==c&&k&&"FusionStartTagOpen"==k.type?d="FusionStartTagClose":">"==c&&k&&"FusionEndTagOpen"==k.type?d="FusionEndTagClose":
"<"==c&&z(g)&&T(k,m)&&(d="HTMLStartTagOpen",t=new v("<"),C(t,c));else"<"==c&&"/"==g&&"script"==b.substr(a+1,6)&&f&&"<script"==f.state&&(a++,d="HTMLEndTagOpen",p=">",w=!0);else"."==c?(c=b[++a],d="JavaScriptPunctuator","."==c&&"."==b[a+1]&&(a+=2)):h&&"@"==c?(g=b[a+1],a++,d="{"==g?"FusionObject":"("==g||"["==g?"FusionSelector":"JavaScriptInvalidCharacter",!n||"{"!=g&&"("!=g&&"["!=g||(t=new v(c+g))):(a++,d="JavaScriptInvalidCharacter");break;case "html":case "fhtml":case "HTMLStartTagClose":case "HTMLStartTagSelfClose":case "HTMLEndTagClose":case "HTMLCharacterReference":case "HTMLCommentClose":case "HTMLBogusCommentClose":case "HTMLDOCTYPEClose":case "HTMLCDATAClose":case "FusionStartTagClose":case "FusionStartTagSelfClose":case "FusionEndTagClose":case "FusionDirectiveTagClose":case "FusionSubstitutionClose":d=
"HTMLText";case "HTMLText":do if(c=b[a],"<"==c)if(g=b[a+1],z(g)){if(a!=l)break;a++;d="HTMLStartTagOpen";f&&C(f,c);break}else if("/"==g){if(a!=l)break;g=b[a+2];h&&"@"==g?(a+=3,d="FusionEndTagOpen"):z(g)?(a+=2,d="HTMLEndTagOpen"):(a+=2,d="HTMLBogusCommentOpen");break}else if(h&&"@"==g){if(a!=l)break;a+=2;d="FusionStartTagOpen";break}else if("!"==g){if(a!=l)break;g=b[a+2];">"==g?(a+=2,d="HTMLBogusCommentOpen"):h&&"@"==g?(a+=3,d="FusionDirectiveTagOpen"):"-"==g&&"-"==b[a+3]?(a+=4,d="HTMLCommentOpen"):
(g=b.substr(a+2,7),"DOCTYPE"==g?(a+=9,d="HTMLDOCTYPEOpen"):"[CDATA["==g?(a+=9,d="HTMLCDATAOpen"):(a+=2,d="HTMLBogusCommentOpen"));break}else{if("?"==g){if(a!=l)break;a+=2;d="HTMLBogusCommentOpen";break}}else if("&"==c){c=null;g=b[a+1];if("#"==g)if(g=b[a+2],"x"==g||"X"==g){if(g=b[a+3],x(g)){if(a!=l)break;a+=4;c=x}}else{if(u(g)){if(a!=l)break;a+=3;c=u}}else if(z(g)){if(a!=l)break;a+=2;c=K}if(c){for(d="HTMLCharacterReference";c(b[a]);)a++;";"!=b[a++]&&a--;break}}else if(h&&"$"==c&&"{"==b[a+1]&&f&&"<"==
f.state){if(a!=l)break;a+=2;d="FusionSubstitutionOpen";t=new v("<${");break}while(++a<e);break;case "HTMLStartTagOpen":case "HTMLEndTagOpen":if(z(b[a])){for(d="HTMLStartTagOpen"!=d?"HTMLEndTagName":"HTMLStartTagName";++a<e&&(c=b[a],">"!=c&&"/"!=c&&!A(c)););f&&(f.tag=b.substring(l,a));break}case "HTMLEndTagName":case "HTMLEndTagText":case "HTMLEndTagWhitespace":g="HTMLStartTagOpen"!=d;case "HTMLStartTagName":case "HTMLStartTagSolidus":case "HTMLStartTagWhitespace":case "HTMLAttributeName":case "HTMLAttributeOperator":case "HTMLAttributeValue":case "HTMLAttributeDoubleQuotedValue":case "HTMLAttributeSingleQuotedValue":case "FusionAttributeTemplateString":case "FusionAttributeTemplateStringTail":c=
b[a];if(">"==c)a++,d=g?"HTMLEndTagClose":"HTMLStartTagClose",f&&((e=g)||(e=f.tag,e="area"==e||"base"==e||"br"==e||"col"==e||"embed"==e||"hr"==e||"img"==e||"input"==e||"keygen"==e||"link"==e||"menuitem"==e||"meta"==e||"param"==e||"source"==e||"track"==e||"wbr"==e),e&&C(f,c),g||(h||"script"!=f.tag)&&"style"!=f.tag||(t=new v("<"+f.tag)),f.tag="");else if(A(c))for(a++,d=g?"HTMLEndTagWhitespace":"HTMLStartTagWhitespace";A(b[a]);)a++;else if(g)for(d="HTMLEndTagText";++a<e&&(c=b[a],">"!=c&&!A(c)););else if("="==
c&&k&&"HTMLAttributeName"==k.type)a++,d="HTMLAttributeOperator";else if(k&&"HTMLAttributeOperator"==k.type)for(k='"'==c||"'"==c||"`"==c&&h&&f&&"<"==f.state?c:null,d="`"==k?"FusionAttributeTemplateString":'"'==k?"HTMLAttributeDoubleQuotedValue":"'"==k?"HTMLAttributeSingleQuotedValue":"HTMLAttributeValue";++a<e;)if(c=b[a],k)if(c==k){a++;break}else{if("`"==k&&"$"==c&&"{"==b[a+1]){a+=2;d="FusionAttributeTemplateStringHead";t=new v("=`${");break}}else{if(">"==c||A(c))break}else if("/"==c)if(c=b[++a],d=
"HTMLStartTagSolidus",">"==c)a++,d="HTMLStartTagSelfClose",f&&(C(f,c),f.tag="");else for(;"/"==c;)c=b[++a];else for(d="HTMLAttributeName";++a<e&&(c=b[a],">"!=c&&"/"!=c&&"="!=c&&!A(c)););break;case "HTMLCommentOpen":d="HTMLCommentText";case "HTMLCommentText":do if(c=b[a],">"==c){if(a==l&&k&&"HTMLCommentOpen"==k.type){a++;d="HTMLCommentClose";break}}else if("-"==c)if(g=b[a+1],">"==g){if(a==l&&k&&"HTMLCommentOpen"==k.type){a+=2;d="HTMLCommentClose";break}}else if("-"==g&&(g=b[a+2],">"==g||"!"==g&&">"==
b[a+3])){if(a!=l)break;a+="!"==g?4:3;d="HTMLCommentClose";break}while(++a<e);break;case "HTMLBogusCommentOpen":d="HTMLBogusCommentText";case "HTMLBogusCommentText":do if(">"==b[a]){if(a!=l)break;a++;d="HTMLBogusCommentClose";break}while(++a<e);break;case "HTMLDOCTYPEOpen":case "HTMLDOCTYPEString":case "HTMLDOCTYPEDoubleQuotedString":case "HTMLDOCTYPESingleQuotedString":case "HTMLDOCTYPEWhitespace":c=b[a];if(">"==c)a++,d="HTMLDOCTYPEClose";else if(A(c))for(a++,d="HTMLDOCTYPEWhitespace";A(b[a]);)a++;
else for(k='"'==c||"'"==c?c:null,d='"'==c?"HTMLDOCTYPEDoubleQuotedString":"'"==c?"HTMLDOCTYPESingleQuotedString":"HTMLDOCTYPEString";++a<e;)if(c=b[a],k){if(c==k){a++;break}}else if(">"==c||A(c))break;break;case "HTMLCDATAOpen":d="HTMLCDATAText";case "HTMLCDATAText":do if("]"==b[a]&&"]"==b[a+1]&&">"==b[a+2]){if(a!=l)break;a+=3;d="HTMLCDATAClose";break}while(++a<e);break;case "css":case "fcss":case "CSSIdentifier":case "CSSNumber":case "CSSDelimiter":case "CSSPunctuator":case "CSSDimension":case "CSSPercentage":case "CSSComma":case "CSSColon":case "CSSSemicolon":case "CSSDoubleQuotedString":case "CSSSingleQuotedString":case "CSSHash":case "CSSFunction":case "CSSAtKeyword":case "CSSMatch":case "CSSUrl":case "CSSColumn":case "CSSUnicodeRange":case "CSSComment":case "CSSWhitespace":case "FusionObject":case "FusionSelector":case "FusionObjectSubstitutionClose":case "FusionSelectorSubstitutionClose":case "FusionStyleSubstitutionClose":c=
b[a];k=u(c);k||"+"!=c&&"-"!=c&&"."!=c||(g=b[a+1],k=u(g)||"."!=c&&"."==g&&u(b[a+2]));if(k){d="CSSNumber";if("."!=c){for(a++;u(b[a]);)a++;c=b[a]}if("."==c&&u(b[a+1])){for(a+=2;u(b[a]);)a++;c=b[a]}g=b[a+1];if(("e"==c||"E"==c)&&(u(g)||("+"==g||"-"==g)&&u(b[a+2]))){for(a+="+"==g||"-"==g?3:2;u(b[a]);)a++;c=b[a]}if("%"==c){a++;d="CSSPercentage";break}else if(!z(c)&&"_"!=c&&"\\"!=c&&"-"!=c&&"\u0080">c)break}if(k||z(c)||"_"==c||"\\"==c||"#"==c||"@"==c||"-"==c||"\u0080"<=c)if(k||"u"!=c&&"U"!=c||"+"!=b[a+1]||
!x(b[a+2])&&"?"!=b[a+2]){d=k?"CSSDimension":"#"==c?"CSSHash":"@"==c?"CSSAtKeyword":"CSSIdentifier";if("\\"==c){if(B(b[a+1])){k||a++;d=k?"CSSNumber":"CSSDelimiter";break}++a<e&&a++}else if("#"==c||"@"==c||"-"==c)if(g=b[a+1],z(g)||"_"==g||"-"==g||"\\"==g&&!B(b[a+2])||!("\u0080">g)||"#"==c&&u(g))if("@"==c&&"-"==g){g=b[a+2];if(!z(g)&&"_"!=g&&"-"!=g&&("\\"!=g||B(b[a+3]))&&"\u0080">g){a++;d="CSSDelimiter";break}a+=3}else a+=2;else{k||a++;d=k?"CSSNumber":"CSSDelimiter";break}else a++;do if(c=b[a],"\\"==
c){if(B(b[a+1]))break;if(++a>=e)break}else if(!K(c)&&"_"!=c&&"-"!=c&&"\u0080">c)break;while(++a<e);if("("==c&&"CSSIdentifier"==d&&(a++,d="CSSFunction",f&&C(f,c),a==l+4&&"url"==b.substr(l,3).toLowerCase())){for(c=0;A(b[a+c]);)c++;g=b[a+c];if('"'!=g&&"'"!=g){a+=c;d="CSSUrl";if(a>=e)break;do if(c=b[a],")"==c){a++;break}else if("\\"==c&&++a>=e)break;while(++a<e)}}}else{a+=2;d="CSSUnicodeRange";for(c=0;6>c&&x(b[a+c]);)c++;g=b[a+c];if("-"==g&&x(b[a+c+1]))for(a+=c+1,c=0;6>c&&x(b[a+c]);)c++;else if("?"==
g)for(;6>c&&"?"==b[a+c];)c++;a+=c}else if("/"==c&&"*"==b[a+1])for(a++,d="CSSComment";++a<e;){if("*"==b[a]&&"/"==b[a+1]){a+=2;break}}else if(A(c))for(a++,d="CSSWhitespace";A(b[a]);)a++;else if('"'==c||"'"==c)for(k=c,d='"'==k?"CSSDoubleQuotedString":"CSSSingleQuotedString";++a<e;)if(c=b[a],"\\"==c){if(++a>=e)break;"\r"==b[a]&&"\n"==b[a+1]&&a++}else if(c==k){a++;break}else{if(B(c))break}else if("$"==c||"*"==c||"^"==c||"|"==c||"~"==c)g=b[a+1],h&&"$"==c&&"{"==g&&f&&("@{:"==f.state||"@("==f.state||"@["==
f.state||"<style"==f.state)?(a+=2,d="@{:"==f.state?"FusionObjectSubstitutionOpen":"@("==f.state||"@["==f.state?"FusionSelectorSubstitutionOpen":"FusionStyleSubstitutionOpen",t=new v(f.state+c+g)):"|"==c&&"|"==g?(a+=2,d="CSSColumn"):"="==g?(a+=2,d="CSSMatch"):(a++,d="CSSDelimiter");else if("("==c||")"==c||"["==c||"]"==c||"{"==c||"}"==c)a++,d="CSSPunctuator",f&&C(f,c);else if(","==c)a++,d="CSSComma";else if(":"==c)a++,d="CSSColon",f&&"@{"==f.state&&(p=c);else if(";"==c)a++,d="CSSSemicolon",f&&"@{:"==
f.state&&(s="@{");else if("<"==c)if(c=b[++a],d="CSSDelimiter","!"==c&&"-"==b[a+1]&&"-"==b[a+2]&&f&&"<style"==f.state)for(a+=2,d="CSSComment";++a<e;){if("-"==b[a]&&"-"==b[a+1]&&">"==b[a+2]){a+=3;break}}else"/"==c&&"style"==b.substr(a+1,5)&&f&&"<style"==f.state&&(a++,d="HTMLEndTagOpen",p=">",w=!0);else a++,d="CSSDelimiter";break;default:return null}this.position=a;this.state=d;h&&f&&"<"==f.state&&0==f.tags?(p=">",w=!0,this.state=q):h&&f&&(("@{"==f.state||"@{:"==f.state)&&0==f.braces||"@("==f.state&&
0==f.parentheses||"@["==f.state&&0==f.brackets)?(w=!0,s="@("==f.state?"@()":"@["==f.state?"@[]":"@{}",this.state=q):t&&"HTMLStartTagClose"==d&&("<script"==t.state?this.state="js":"<style"==t.state&&(this.state="css"));f&&(s&&(f.state=s),p&&(f.state+=p));n&&(t?w&&r?n[r-1]=t:n.push(t):w&&n.pop());if(a==l)return null;k=new P(d,b,l,a);H(d)||L(d)||(this.expression=f&&w?f.state:"",this.token=k);return k},!0);r(m,"peek",function(b,e){var l=new G;l.language=this.language;l.position=b||this.position;l.source=
this.source;l.state=e||this.state;for(var k=l.next();k;){var m=k.type;if(!H(m)&&!L(m))break;k=l.next()}return k},!0);r(m,"reset",function(){this.chain=null;this.expression="";this.position=0;this.state="";this.token=null},!0);(function(){}.prototype={}).lexer=null;var v=function(b){this.state=b||""},m=v.prototype={};m.braces=0;m.brackets=0;m.parentheses=0;m.state="";m.tag="";m.tags=0;r(m,"clone",function(){var b=new v;b.braces=this.braces;b.brackets=this.brackets;b.parentheses=this.parentheses;b.state=
this.state;b.tag=this.tag;b.tags=this.tags;return b},!0);r(m,"equals",function(b){return this.braces===b.braces&&this.brackets===b.brackets&&this.parentheses===b.parentheses&&this.state===b.state&&this.tag===b.tag&&this.tags===b.tags},!0);var P=function(b,e,l,k){this.type=b;this.source=e;this.start=l;this.end=k},m=P.prototype={};m.end=0;m.source="";m.start=0;m.type="";r(m,"clone",function(){return new P(this.type,this.source,this.start,this.end)},!0);r(m,"equals",function(b){return this.type===b.type&&
this.text()===b.text()},!0);r(m,"html",function(){var b=this.text().replace(aa,ba);return!this.type||H(this.type)||U(this.type)?b:'<span class="fusion_'+this.type+'">'+b+"</span>"},!0);r(m,"node",function(){if(!this.type||H(this.type)||U(this.type))return document.createTextNode(this.text());var b=document.createElement("span");this.type&&b.setAttribute("class","fusion_"+this.type);b.innerText=this.text();return b},!0);r(m,"text",function(){return this.source.substring(this.start,this.end)},!0);E("highlight",
function(b,e,l){b=new G(b,e||"fjs");e="";var k=null,m=null,q=null;for(l||b.hack();m=b.next();)if(l||!y(m.type,"CSS"))e+=m.html(),k=b.token;else{null==q&&(q=[]);k&&(y(k.type,"CSS")||"FusionObjectSubstitutionClose"==k.type||"FusionSelectorSubstitutionClose"==k.type||"FusionStyleSubstitutionClose"==k.type)||q.unshift("*");var a=m.type;if(H(a)||L(a))e+=m.html();else{var d=q[0],h=null,n="CSSPunctuator"==a?m.text():null;if("{"==n)"*"!=d&&"@"!=d?(d="*{",q.unshift(d)):q[0]+=n;else if("}"==n)"*{"==d||"*{:"==
d?1<q.length?q.shift():q[0]="*":"@{"!=d&&"@{:"!=d||q.shift();else if("CSSSemicolon"==a)if("@"==d)q.shift();else{if("*{:"==d||"@{:"==d)q[0]=d[0]+"{"}else if("CSSColon"!=a||"*{"!=d&&"@{"!=d){if("CSSAtKeyword"!=a||"*"!=d&&"*{"!=d&&"@{"!=d||(d="@",q.unshift(d)),n="@{"==d&&"CSSIdentifier"==a?b.peek(m.end):null,h="*{"==d&&"CSSIdentifier"==a||n&&"CSSColon"==n.type?"CSSDeclarationName":"*{:"==d||"@{:"==d?"CSSDeclarationValue":"*"==d||"@{"==d?"CSSSelector":"@"==d?"CSSAtRule":null,"*{:"==d||"@{:"==d)"CSSDelimiter"==
a&&"!"==m.text()?(n=b.peek(m.end))&&"CSSIdentifier"==n.type&&"important"==n.text().toLowerCase()&&(n=b.peek(n.end))&&("CSSSemicolon"==n.type||"CSSPunctuator"==n.type&&"}"==n.text())&&(h="CSSDeclarationImportant"):k&&"CSSDelimiter"==k.type&&"!"==k.text()&&"CSSIdentifier"==a&&"important"==m.text().toLowerCase()&&(n=b.peek(m.end))&&("CSSSemicolon"==n.type||"CSSPunctuator"==n.type&&"}"==n.text())&&(h="CSSDeclarationImportant")}else q[0]+=":";h?(k=m.clone(),k.type=h,e+=k.html()):e+=m.html();k=b.token}}return e});
E("parse",function(b,e,l){});E("tokenize",function(b,e,l){b=new G(b,e||"fjs");e=null;var k=[];for(l||b.hack();e=b.next();)k.push({type:e.type,start:e.start,end:e.end});return k});E("transpile",function(b,e,l,k,m,q){b=new G(b,"fjs");for(var a="",d=null,h=null,n=[],r=function(a,b){return b.toUpperCase()};d=b.next();){if("FusionSelector"==d.type||"FusionSelectorSubstitutionClose"==d.type){for(var f="",p="FusionSelector"==d.type,g=!0;d=b.next();)if("FusionSelectorSubstitutionOpen"==d.type)h=b.peek(),
h&&"JavaScriptPunctuator"==h.type&&"}"==h.text()||(f+='"+(',g=!1),h=b.token;else if("FusionSelectorSubstitutionClose"==d.type)h&&"FusionSelectorSubstitutionOpen"==h.type||(f+=')+"',g=!0),h=b.token;else{if(!y(d.type,"CSS"))break;L(d.type)||(f+=d.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n"),h=b.token)}var s=/^\(\s*(head|html|body)\s*\)$/i.exec(f);s?(f=s[1].toLowerCase(),a+="document."+("html"==f?"documentElement":f)):(a+=p?"["==f[0]?(k||"document.__query")+'("':(l||"document.__find")+
'("':')+"',a+=f.substr(p?1:0,f.length-(p&&g?2:1)),g&&(a+='")'))}else if("FusionObject"==d.type||"FusionObjectSubstitutionClose"==d.type)for(f="FusionObject"!=d.type,!f||h&&"FusionObjectSubstitutionOpen"==h.type||(a+=')+"');d=b.next();)if("FusionObjectSubstitutionOpen"==d.type)h&&"CSSColon"==h.type&&(a+='"'),(h=b.peek())&&"JavaScriptPunctuator"==h.type&&"}"==h.text()||(a+='"+('),h=b.token;else if("FusionObjectSubstitutionClose"==d.type)h&&"FusionObjectSubstitutionOpen"==h.type||(a+=')+"'),h=b.token;
else{if(!y(d.type,"CSS"))break;if(!L(d.type)){if(p=H(d.type)?d:null)if(d=b.next(),!d){a+=p.text();break}if(f){if("CSSPunctuator"==d.type&&"}"==d.text()&&"fjs"==b.state){h&&"CSSSemicolon"==h.type||(a+='"');p&&(a+=p.text());a+=d.text();h=b.token;continue}else if("CSSSemicolon"==d.type){a+='"';f=!1;p&&(a+=p.text());h=b.token;continue}else p&&(a+=p.text().replace(/\n/g,"\\n\\\n"));"FusionObjectSubstitutionOpen"==d.type?(h=b.peek())&&"JavaScriptPunctuator"==h.type&&"}"==h.text()||(a+='"+('):"FusionObjectSubstitutionClose"==
d.type?h&&"FusionObjectSubstitutionOpen"==h.type||(a+=')+"'):a+=d.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"')}else"CSSIdentifier"==d.type&&h&&("CSSPunctuator"==h.type&&"{"==h.text()||"CSSSemicolon"==h.type)?("CSSSemicolon"==h.type&&(a+=","),p&&(a+=p.text()),a+='"',a+=d.text().replace(/^-+/,"").replace(/-+([a-z])/ig,r),a+='"'):"CSSColon"==d.type?(p&&(a+=p.text()),a+=d.text()):"CSSSemicolon"==d.type?p&&(a+=p.text()):h&&"CSSColon"==h.type?(p&&(a+=p.text()),f=!0,"fjs"!=b.state&&(a+='"'),"FusionObjectSubstitutionOpen"==
d.type?(h=b.peek())&&"JavaScriptPunctuator"==h.type&&"}"==h.text()||(a+='"+('):"FusionObjectSubstitutionClose"==d.type?h&&"FusionObjectSubstitutionOpen"==h.type||(a+=')+"'):a+=d.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"')):(p&&(a+=p.text()),a+=d.text());h=b.token}}if(!d)break;if("FusionProperty"==d.type)a+=".__"+d.text().substr(1);else if("FusionSubstitutionOpen"==d.type||"FusionStyleSubstitutionOpen"==d.type)a+='"+(';else if("FusionSubstitutionClose"==d.type||"FusionStyleSubstitutionClose"==
d.type)a+=')+"';else if("HTMLStartTagOpen"==d.type)n.length&&(a+=d.text());else if("HTMLStartTagName"==d.type)f=d.text(),n.push(f),f=f.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),a+=1<n.length?f:(e||"document.__create")+'("'+f+'")';else if(n.length)if("HTMLStartTagClose"==d.type)!h||"HTMLAttributeName"!=h.type&&"HTMLAttributeOperator"!=h.type?!h||"FusionAttributeTemplateString"!=h.type&&"FusionAttributeTemplateStringTail"!=h.type||(a+=")"):a+='"")',f=n[n.length-1],"area"==f||"base"==f||"br"==f||"col"==
f||"embed"==f||"hr"==f||"img"==f||"input"==f||"keygen"==f||"link"==f||"menuitem"==f||"meta"==f||"param"==f||"source"==f||"track"==f||"wbr"==f?(n.pop(),n.length&&(a+=d.text())):a+=1<n.length?d.text():"."+(q||"__html")+'("';else if("HTMLEndTagOpen"==d.type)a+=1<n.length?d.text():'")';else if("HTMLEndTagName"==d.type){f=d.text();if(f!=n[n.length-1])throw"unmatched <"+n[n.length-1]+"> tag";1<n.length&&(a+=f.replace(/\\/g,"\\\\").replace(/"/g,'\\"'))}else if("HTMLStartTagSelfClose"==d.type||"HTMLEndTagClose"==
d.type||"HTMLEndTagSelfClose"==d.type)"HTMLStartTagSelfClose"==d.type&&h&&"HTMLAttributeName"==h.type?a+='"")':"HTMLStartTagSelfClose"!=d.type||!h||"FusionAttributeTemplateString"!=h.type&&"FusionAttributeTemplateStringTail"!=h.type||(a+=")"),n.pop(),n.length&&(a+=d.text());else if(1==n.length&&"HTMLAttributeName"==d.type)h&&"HTMLAttributeName"==h.type?a+='"")':!h||"FusionAttributeTemplateString"!=h.type&&"FusionAttributeTemplateStringTail"!=h.type||(a+=")"),a+="."+(m||"__attr")+'("',a+=d.text().replace(/\\/g,
"\\\\").replace(/"/g,'\\"'),a+='",';else if(1==n.length&&("HTMLAttributeValue"==d.type||"HTMLAttributeDoubleQuotedValue"==d.type||"HTMLAttributeSingleQuotedValue"==d.type)){f=d.text();"HTMLAttributeValue"!=d.type&&(f=f.substr(1,f.length-2));a+='"';d=0;for(p=f.length;d<p;){g=f[d];if("&"==g)if(h=f[d+1],"#"==h)if(h=f[d+2],"x"==h||"X"==h){if(h=f[d+3],x(h)){d+=3;h="";do{g=f[d];if(!x(g))break;h+=g}while(++d<p);for(";"!=f[d++]&&d--;4>h.length;)h="0"+h;a+="\\u";a+=h;continue}}else{if("0"<=h&&"9">=h){d+=2;
h="";do{g=f[d];if("0">g||"9"<g)break;h+=g}while(++d<p);";"!=f[d++]&&d--;for(h=Z(h,10).toString(16);4>h.length;)h="0"+h;a+="\\u";a+=h;continue}}else{if(z(h)){d++;h="&";do{g=f[d];if(!K(g))break;h+=g}while(++d<p);";"!=f[d++]?d--:h+=";";g=N[h.substr(1)];R(g)?g="\\u"+O(g[0],4,"0")+"\\u"+O(g[1],4,"0"):g&&(g="\\u"+O(g,4,"0"));a+=g?g:h;continue}}else if('"'==g){a+='\\"';d++;continue}else if("\n"==g){a+="\\n\\\n";d++;continue}else if("\\"==g){a+="\\\\";d++;continue}a+=g;d++}a+='")'}else if(1==n.length&&"HTMLStartTagSolidus"==
d.type)h&&"HTMLAttributeName"==h.type?a+='"")':!h||"FusionAttributeTemplateString"!=h.type&&"FusionAttributeTemplateStringTail"!=h.type||(a+=")");else if("FusionAttributeTemplateString"==d.type||"FusionAttributeTemplateStringHead"==d.type||"FusionAttributeTemplateStringMiddle"==d.type||"FusionAttributeTemplateStringTail"==d.type){f=d.text();d="`"==f[0];p="`"==f[f.length-1];if(d)a+='"';else if(!h||"FusionAttributeTemplateStringHead"!=h.type&&"FusionAttributeTemplateStringMiddle"!=h.type||"`"==h.source[h.end-
1])a+=')+"';a+=f.substr(1,p?f.length-2:f.length-3).replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n");p?a+='"':(h=b.peek())&&"JavaScriptPunctuator"==h.type&&"}"==h.text()||(a+='"+(')}else if("HTMLText"==d.type||y(d.type,"CSS"))a+=d.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n");else if("HTMLStartTagWhitespace"==d.type)a+=h&&"HTMLAttributeOperator"==h.type?d.text():d.text().replace(/^[^\r\n]+/,"");else{if(1<n.length||"HTMLEndTagText"!=d.type&&"HTMLEndTagSolidus"!=d.type&&"HTMLAttributeOperator"!=
d.type)a+=d.text()}else"JavaScriptTemplateString"==d.type?(f=d.text(),d="`"==f[0],p="`"==f[f.length-1],d&&h&&("JavaScriptIdentifier"==h.type||"JavaScriptPunctuator"==h.type&&(")"==h.text()||h.text())),d?a+='"':h&&"JavaScriptTemplateString"==h.type&&"`"!=h.source[h.end-1]||(a+=')+"'),a+=f.substr(1,p?f.length-2:f.length-3).replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n"),p?a+='"':(h=b.peek())&&"JavaScriptPunctuator"==h.type&&"}"==h.text()||(a+='"+(')):a+=d.text();h=b.token}if(n.length)throw"unmatched <"+
n[n.length-1]+"> tag";return a});"function"==typeof define&&define.amd?define(function(){return D}):"undefined"!=typeof module&&null!=module&&module.exports?module.exports=D:function(b){var e=F.f_Shorthand,l=F.f_Writable;"string"!=typeof e&&(e=!0===e?"f":"");"boolean"!=typeof l&&(l="undefined"!=typeof F.intellisense);!b||Y.call(b,"fusion")&&!l||(e&&r(b,e,D,l),r(b,"fusion",D,l))}(I.window===I?I:F)})(this);