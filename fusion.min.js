/*! ------------------------------------------------------------------------
//                                   Fusion
//  ------------------------------------------------------------------------
//
//                       Copyright 2014 Nicholas Gaulin
//
//       Licensed under the Apache License, Version 2.0 (the "License");
//      you may not use this file except in compliance with the License.
//                   You may obtain a copy of the License at
//
//                 http://www.apache.org/licenses/LICENSE-2.0
//
//     Unless required by applicable law or agreed to in writing, software
//      distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//     See the License for the specific language governing permissions and
//                       limitations under the License.
*/
(function(I,ja){I||(I={});var D=Object,O=D.create,U=D.defineProperty,K=D.freeze,p=D.getPrototypeOf,F=D.keys,Z=D.preventExtensions,$=D.seal,aa=D.prototype.hasOwnProperty,P=Array,D=P.prototype,V=P.isArray,P=Error,ba=parseInt,ca=String.prototype;if(!(O&&U&&K&&p&&Z&&$&&V&&D.forEach&&D.indexOf&&ca.trim))throw new P("JavaScript engine does not support ECMAScript 5.");var K="undefined"!=typeof window&&null!=window&&window.window===window?window:{},Q={Aacute:"C1",aacute:"E1",Acirc:"C2",acirc:"E2",acute:"B4",
AElig:"C6",aelig:"E6",Agrave:"C0",agrave:"E0",amp:"26",AMP:"26",Aring:"C5",aring:"E5",Atilde:"C3",atilde:"E3",Auml:"C4",auml:"E4",brvbar:"A6",Ccedil:"C7",ccedil:"E7",cedil:"B8",cent:"A2",copy:"A9",COPY:"A9",curren:"A4",deg:"B0",divide:"F7",Eacute:"C9",eacute:"E9",Ecirc:"CA",ecirc:"EA",Egrave:"C8",egrave:"E8",ETH:"D0",eth:"F0",Euml:"CB",euml:"EB",frac12:"BD",frac14:"BC",frac34:"BE",gt:"3E",GT:"3E",Iacute:"CD",iacute:"ED",Icirc:"CE",icirc:"EE",iexcl:"A1",Igrave:"CC",igrave:"EC",iquest:"BF",Iuml:"CF",
iuml:"EF",laquo:"AB",lt:"3C",LT:"3C",macr:"AF",micro:"B5",middot:"B7",nbsp:"A0",not:"AC",Ntilde:"D1",ntilde:"F1",Oacute:"D3",oacute:"F3",Ocirc:"D4",ocirc:"F4",Ograve:"D2",ograve:"F2",ordf:"AA",ordm:"BA",Oslash:"D8",oslash:"F8",Otilde:"D5",otilde:"F5",Ouml:"D6",ouml:"F6",para:"B6",plusmn:"B1",pound:"A3",quot:"22",QUOT:"22",raquo:"BB",reg:"AE",REG:"AE",sect:"A7",shy:"AD",sup1:"B9",sup2:"B2",sup3:"B3",szlig:"DF",THORN:"DE",thorn:"FE",times:"D7",Uacute:"DA",uacute:"FA",Ucirc:"DB",ucirc:"FB",Ugrave:"D9",
ugrave:"F9",uml:"A8",Uuml:"DC",uuml:"FC",Yacute:"DD",yacute:"FD",yen:"A5",yuml:"FF"},da=/[<>&'"]/g;F(Q).forEach(function(b,d,k){Q[b+";"]=Q[b]});var n=function(b,d,k,l,v,m){U(b,d,{configurable:!!m,enumerable:!!v,value:k,writable:!!l})},F="ABCDEFGHIJKLMNOPQRSTUVWXYZ";O(null);var F=F+F.toLowerCase(),L=function(b,d,k){if(!d||!b||d.length>b.length)return!1;if(!k||k>b.length)k=b.length;return d==b.substr(k-d.length)},ea=function(b){return"&#"+b.charCodeAt(0)+";"},S=function(b,d,k){for(k||(k=" ");b.length<
d;)b=k+b;return b},w=function(b,d,k){if(!d||!b||d.length>b.length)return!1;if(!k||0>k)k=0;return d==b.substr(k,d.length)},M=function(b){return"a"<=b&&"z">=b||"A"<=b&&"Z">=b||"0"<=b&&"9">=b},fa=function(b){return"0"==b||"1"==b},x=function(b){return"a"<=b&&"f">=b||"A"<=b&&"F">=b||"0"<=b&&"9">=b},z=function(b){return"a"<=b&&"z">=b||"A"<=b&&"Z">=b},E=function(b){return"\r"==b||"\n"==b||"\u2028"==b||"\u2029"==b},t=function(b){return"0"<=b&&"9">=b},ga=function(b){return"0"<=b&&"7">=b},A=function(b){return" "==
b||"\r"==b||"\n"==b||"\t"==b||"\f"==b},W=function(b){return"\t"==b||"\v"==b||"\f"==b||" "==b||"\u00a0"==b||"\ufeff"==b},F=function(b,d){if(0<=b.indexOf(" "))for(var k=b.split(" "),l=0,v=k.length;l<v;l++)n(G,k[l],d);else n(G,b,d)},G=function(){};n(G,"dev",!1,void 0,!0);n(G,"version","1.0.0b",void 0,!0);var T=function(b,d,k,l){this.type=b;this.source=d;this.start=k;this.end=l},p=T.prototype={};p.end=0;p.source="";p.start=0;p.type="";n(p,"clone",function(){return new T(this.type,this.source,this.start,
this.end)},!0);n(p,"equals",function(b){return this.type===b.type&&this.text()===b.text()},!0);n(p,"html",function(){var b=this.text().replace(da,ea);return!this.type||J(this.type)||X(this.type)?b:'<span class="fusion_'+this.type+'">'+b+"</span>"},!0);n(p,"node",function(){if(!this.type||J(this.type)||X(this.type))return document.createTextNode(this.text());var b=document.createElement("span");this.type&&b.setAttribute("class","fusion_"+this.type);b.innerText=this.text();return b},!0);n(p,"text",
function(){return this.source.substring(this.start,this.end)},!0);var u=function(b){this.state=b||""},p=u.prototype={};p.braces=0;p.brackets=0;p.parentheses=0;p.state="";p.tag="";p.tags=0;n(p,"clone",function(){var b=new u;b.braces=this.braces;b.brackets=this.brackets;b.parentheses=this.parentheses;b.state=this.state;b.tag=this.tag;b.tags=this.tags;return b},!0);n(p,"equals",function(b){return this.braces===b.braces&&this.brackets===b.brackets&&this.parentheses===b.parentheses&&this.state===b.state&&
this.tag===b.tag&&this.tags===b.tags},!0);var H=function(b,d){b&&(this.source=b);d&&(this.language=d,this.chain="html"==d||"fhtml"==d?[new u("#document")]:"js"==d||"fjs"==d||"fcss"==d?[]:null)},r=H.prototype={},B=function(b,d,k,l){if(!l){if("<"!=b[d])return!1}else if("<"!=l)return!1;return"/"!=b[d+1]?!1:">"==b[d+k.length+2]&&b.substr(d+2,k.length).toLowerCase()==k},ha=function(b,d,k){return b.clone()},N=function(b){return"JavaScriptBlockComment"==b||"JavaScriptLineComment"==b||"HTMLCommentOpen"==
b||"HTMLCommentText"==b||"HTMLCommentClose"==b||"HTMLBogusCommentOpen"==b||"HTMLBogusCommentText"==b||"HTMLBogusCommentClose"==b||"CSSComment"==b},C=function(b,d){if("<!CDATA"!=b.state)if("{"==d||"}"==d)b.braces+="{"==d?1:b.braces?-1:0;else if("("==d||")"==d)b.parentheses+="("==d?1:b.parentheses?-1:0;else if("["==d||"]"==d)b.brackets+="["==d?1:b.brackets?-1:0;else if("<"==d||">"==d)b.tags+="<"==d?1:b.tags?-1:0},Y=function(b,d){if(!b)return!0;var k=b.type;return"JavaScriptPunctuator"==k?(k=b.text(),
(")"!=k||d&&("for()"==d||"if()"==d||"while()"==d||"with()"==d))&&("}"!=k||!d||"{}"!=d)&&"]"!=k&&"++"!=k&&"--"!=k):"JavaScriptReservedWord"==k?(k=b.text(),"case"==k||"delete"==k||"do"==k||"else"==k||"extends"==k||"in"==k||"instanceof"==k||"new"==k||"return"==k||"throw"==k||"typeof"==k||"void"==k||"yield"==k):"JavaScriptTemplateString"==k?"`"!=b.source.substr(b.end-1,1):"FusionAttributeTemplateStringHead"==k||"FusionAttributeTemplateStringMiddle"==k||"FusionSubstitutionOpen"==k||"FusionObjectSubstitutionOpen"==
k||"FusionSelectorSubstitutionOpen"==k||"FusionStyleSubstitutionOpen"==k},X=function(b){return"JavaScriptInvalidCharacter"==b||"HTMLText"==b||"HTMLEndTagText"==b},J=function(b){return"JavaScriptWhitespace"==b||"HTMLStartTagWhitespace"==b||"HTMLEndTagWhitespace"==b||"HTMLDOCTYPEWhitespace"==b||"CSSWhitespace"==b};r.chain=null;r.expression="";r.language="";r.position=0;r.source="";r.state="";r.token=null;n(r,"clone",function(){var b=new ("function"==typeof this._clone&&r.isPrototypeOf(this._clone.prototype)?
this._clone:H);b.chain=this.chain?this.chain.map(ha):null;b.expression=this.expression;b.language=this.language;b.position=this.position;b.source=this.source;b.state=this.state;b.token=this.token?this.token.clone():null;return b},!0);n(r,"equals",function(b){if(!(b instanceof H)||this.expression!==b.expression||this.language!==b.language||this.state!==b.state)return!1;var d=b.chain,k=this.chain;if((k&&k.length||0)!=(d&&d.length||0)||!this.token!=!b.token||this.token&&!this.token.equals(b.token))return!1;
if(k){b=0;for(var l=k.length;b<l;b++)if(!k[b].equals(d[b]))return!1}return!0},!0);n(r,"hack",function(){if(this.chain)return!1;var b=this.language;this.chain="html"==b||"fhtml"==b?[new u("#document")]:"js"==b||"fjs"==b||"fcss"==b?[]:null;return!!this.chain},!0);n(r,"next",function(){var b=this.source,d=b.length,k=this.position,l=this.token,v=this.expression,m=this.language,a=this.position,e=this.state||m,h="fjs"==m||"fhtml"==m||"fcss"==m,y=this.chain,p=y?y.length:0,f=p?y[p-1]:null;if(0>a||a>=d)return null;
var q="",g=!1,s=0,n=null,r="";switch(e){case "js":case "fjs":case "JavaScriptIdentifier":case "JavaScriptReservedWord":case "JavaScriptPunctuator":case "JavaScriptNumber":case "JavaScriptDoubleQuotedString":case "JavaScriptSingleQuotedString":case "JavaScriptTemplateString":case "JavaScriptRegExp":case "JavaScriptBlockComment":case "JavaScriptLineComment":case "JavaScriptInvalidCharacter":case "JavaScriptWhitespace":case "FusionStartTagOpen":case "FusionEndTagOpen":case "FusionDirectiveTagOpen":case "FusionProperty":case "FusionAttributeTemplateStringHead":case "FusionAttributeTemplateStringMiddle":case "FusionSubstitutionOpen":case "FusionObjectClose":case "FusionObjectSubstitutionOpen":case "FusionSelectorClose":case "FusionSelectorSubstitutionOpen":case "FusionStyleSubstitutionOpen":var c=
b[a];if(z(c)||"_"==c||"$"==c||"\\"==c||"@"==c&&h&&l&&("JavaScriptIdentifier"==l.type||!("JavaScriptPunctuator"!=l.type&&"CSSPunctuator"!=l.type||")"!=b[l.start]&&"]"!=b[l.start]))){"\\"!=c&&a++;e="@"==c?"FusionProperty":"JavaScriptIdentifier";do if(c=b[a],!M(c)&&"_"!=c&&"$"!=c&&"\u200c"!=c&&"\u200d"!=c){if("\\"!=c)break;g=b[a+1];if("u"!=g)break;g=b[a+2];if("{"==g){for(c=0;x(b[a+c+3]);)c++;if(c&&"}"==b[a+c+3])a+=c+3;else break}else if(x(g)&&x(b[a+3])&&x(b[a+4])&&x(b[a+5]))a+=5;else break}while(++a<
d);a==k?(a++,e="JavaScriptInvalidCharacter"):l&&"JavaScriptPunctuator"==l.type&&"."==l.text()||h&&"FusionProperty"==e||((d=b.substring(k,a),h&&l&&("FusionStartTagOpen"==l.type&&("break"==d||"case"==d||"continue"==d||"default"==d||"do"==d||"else"==d||"for"==d||"if"==d||"switch"==d||"while"==d)||"FusionEndTagOpen"==l.type&&"while"==d))?(e="JavaScriptReservedWord",n=new u("FusionEndTagOpen"==l.type?"</@"+d:"<@"+d)):"null"==d||"false"==d||"true"==d||"break"==d||"case"==d||"catch"==d||"class"==d||"const"==
d||"continue"==d||"debugger"==d||"default"==d||"delete"==d||"do"==d||"else"==d||"enum"==d||"export"==d||"extends"==d||"finally"==d||"for"==d||"function"==d||"if"==d||"implements"==d||"import"==d||"in"==d||"instanceof"==d||"interface"==d||"let"==d||"new"==d||"package"==d||"private"==d||"protected"==d||"public"==d||"return"==d||"static"==d||"super"==d||"switch"==d||"this"==d||"throw"==d||"try"==d||"typeof"==d||"var"==d||"void"==d||"while"==d||"with"==d||"yield"==d?((m=l&&"JavaScriptReservedWord"==l.type?
l.text():null)&&("get"==m||"set"==m)||f&&"{"==f.state||(e="JavaScriptReservedWord"),h&&"else"==m&&f&&"<@else"==f.state&&("do"==d||"for"==d||"if"==d||"switch"==d||"while"==d)&&(q=" "+d)):"get"!=d&&"set"!=d||!f||"{"!=f.state||(d=(g=this.peek(a))?g.type:null,"JavaScriptIdentifier"!=d&&"JavaScriptReservedWord"!=d)||(d=(g=this.peek(g.end))?g.type:null,"JavaScriptPunctuator"==d&&"("==b[g.start]&&(e="JavaScriptReservedWord",r="{:")))}else if(W(c)||E(c)){a++;e="JavaScriptWhitespace";do if(c=b[a],!W(c)&&!E(c))break;
while(++a<d)}else if('"'==c||"'"==c||"`"==c&&y||"}"==c&&f&&0==f.braces&&L(f.state,"`${"))for(g="}"==c&&"=`${"==f.state,l="}"!=c?c:"`",e=g?"FusionAttributeTemplateStringTail":'"'==l?"JavaScriptDoubleQuotedString":"'"==l?"JavaScriptSingleQuotedString":"JavaScriptTemplateString","}"==c&&(q=c+l,s++);++a<d;){c=b[a];if(!h&&"html"==m&&B(b,a,"script",c))break;if("\\"==c){if(++a>=d)break;"\r"==b[a]&&"\n"==b[a+1]&&a++}else if(c==l){a++;break}else if("`"==l){if("$"==c&&"{"==b[a+1]){a+=2;n=new u(s?f.state:"`${");
g&&(e="FusionAttributeTemplateStringMiddle");break}}else if(E(c))break}else if("/"==c)if(g=b[a+1],"*"==g)for(a++,e="JavaScriptBlockComment";++a<d;){c=b[a];if(!h&&"html"==m&&B(b,a,"script",c))break;if("*"==c&&"/"==b[a+1]){a+=2;break}}else if("/"==g)for(a++,e="JavaScriptLineComment";++a<d;){c=b[a];if(!h&&"html"==m&&B(b,a,"script",c))break;if(E(c))break}else if(h&&">"==g&&f&&w(f.state,"<@")&&("<@break"==f.state||"<@case"==f.state||"<@continue"==f.state||"<@default"==f.state||"<@else"==f.state))a+=2,
e="FusionStartTagSelfClose",q=c+g,s++;else if(Y(l,v)){e="JavaScriptRegExp";for(g=!1;++a<d;){c=b[a];if(!h&&"html"==m&&B(b,a,"script",c))break;if("\\"==c){if(++a>=d||E(b[a]))break}else if(!g&&"/"==c){a++;break}else if(!g&&"["==c)g=!0;else if(g&&"]"==c)g=!1;else if(E(c))break}if("/"==c&&(c=b[a],z(c)||"_"==c||"$"==c)){a++;do if(c=b[a],!M(c)&&"_"!=c&&"$"!=c&&"\u200c"!=c&&"\u200d"!=c)break;while(++a<d)}}else a++,e="JavaScriptPunctuator","="==b[a]&&a++;else if(t(c)||"."==c&&t(b[a+1]))if(e="JavaScriptNumber",
g="0"==c?b[a+1]:null,"0"!=c||"."==g||"e"==g||"E"==g){if("."!=c){for(a++;t(b[a]);)a++;c=b[a]}if("."==c){for(a++;t(b[a]);)a++;c=b[a]}g=b[a+1];if(("e"==c||"E"==c)&&(t(g)||("+"==g||"-"==g)&&t(b[a+2])))for(a+="+"==g||"-"==g?3:2;t(b[a]);)a++}else{if(a++,(c="b"==g||"B"==g?fa:"o"==g||"O"==g?ga:"x"==g||"X"==g?x:null)&&c(b[a+1]))for(a+=2;c(b[a]);)a++}else if("{"==c){if(a++,e="JavaScriptPunctuator",y){d=l&&"JavaScriptReservedWord"==l.type?l.text():null;g=l&&"JavaScriptPunctuator"==l.type?l.text():null;if(d&&
"do"!=d&&"else"!=d&&"export"!=d&&"finally"!=d&&"import"!=d&&"try"!=d||g&&"{"!=g&&";"!=g&&"=>"!=g&&"}"!=g)if("("==g||"["==g||","==g||"?"==g||":"==g||"="==g)n=new u("{");else if(!v||!L(v,"()"))if(d=(g=this.peek(a))?g.type:null,"JavaScriptIdentifier"==d||"JavaScriptReservedWord"==d||"JavaScriptDoubleQuotedString"==d||"JavaScriptSingleQuotedString"==d)m="JavaScriptIdentifier"==d?g.text():null,d=(g=this.peek(g.end))?g.type:null,"JavaScriptPunctuator"==d&&":"==g.text()?n=new u("{"):"get"!=m&&"set"!=m||
"JavaScriptIdentifier"!=d&&"JavaScriptReservedWord"!=d||(d=(g=this.peek(g.end))?g.type:null,"JavaScriptPunctuator"==d&&"("==b[g.start]&&(n=new u("{")));f&&!n&&C(f,c)}}else if("}"==c){if(a++,e="JavaScriptPunctuator",f){if(0==f.braces)if(h&&L(f.state,"${"))e="<${"==f.state?"FusionSubstitutionClose":"@{:${"==f.state?"FusionObjectSubstitutionClose":"@(${"==f.state||"@[${"==f.state?"FusionSelectorSubstitutionClose":"FusionStyleSubstitutionClose",q=c,s++;else if("{"==f.state||"{:"==f.state)r="{}",s++;s||
C(f,c)}}else if("("==c){a++;e="JavaScriptPunctuator";if(h&&f&&(w(f.state,"<@")||w(f.state,"</@"))){if(d=f.state,"<@for"==d||"<@if"==d||"<@switch"==d||"<@while"==d||"<@else for"==d||"<@else if"==d||"<@else switch"==d||"<@else while"==d||"</@while"==d)q=c}else y&&l&&"JavaScriptReservedWord"==l.type&&(m=l.text(),"catch"==m||"function"==m||"for"==m||"if"==m||"switch"==m||"while"==m||"with"==m)&&(n=new u(m+"("));f&&!n&&C(f,c)}else if(")"==c)a++,e="JavaScriptPunctuator",f&&L(f.state,"(")&&(h&&(w(f.state,
"<@")||w(f.state,"</@"))?1==f.parentheses&&(q=c):0==f.parentheses&&(q=c,s++)),f&&!s&&C(f,c);else if("["==c||"]"==c)a++,e="JavaScriptPunctuator",f&&C(f,c);else if(":"==c)a++,e="JavaScriptPunctuator",f&&0==f.braces&&"{"==f.state&&(r="{:");else if(","==c)a++,e="JavaScriptPunctuator",f&&0==f.braces&&"{:"==f.state&&(r="{");else if(";"==c||"?"==c||"~"==c)a++,e="JavaScriptPunctuator";else if("="==c)c=b[++a],e="JavaScriptPunctuator","="==c?"="==b[++a]&&a++:">"==c&&a++;else if("&"==c||"|"==c||"+"==c||"-"==
c)g=b[a+1],a+=c==g||"="==g?2:1,e="JavaScriptPunctuator";else if("!"==c||"*"==c||"^"==c||"%"==c)e="JavaScriptPunctuator","="==b[a+1]?(a+=2,"!"==c&&"="==b[a]&&a++):a++;else if("<"==c||">"==c)if(g=b[a+1],c==g||"="==g)a+=2,e="JavaScriptPunctuator",c==g&&(c=b[a],">"==g&&">"==c&&(c=b[++a]),"="==c&&a++);else{a++;e="JavaScriptPunctuator";if("<"==c&&"/"==g&&f&&B(b,a-1,"script",c)){d=-1;for(m=p-1;0<=m;m--)if("<script"==y[m].state){d=m;break}0<=d&&(a++,e="HTMLEndTagOpen",q=">",s=p-d)}if(h&&!s)if(">"==c&&f&&
(w(f.state,"<@")||w(f.state,"</@"))){if(L(f.state,"()")||"<@do"==f.state||"<@else do"==f.state)e=w(f.state,"</@")?"FusionEndTagClose":"FusionStartTagClose",q=c,s++}else"<"==c&&"/"==g&&"@"==b[a+1]&&f&&"<@"==f.state?(a+=2,e="FusionEndTagOpen"):">"==c&&l&&"FusionStartTagOpen"==l.type?e="FusionStartTagClose":">"==c&&l&&"FusionEndTagOpen"==l.type?e="FusionEndTagClose":"<"==c&&z(g)&&Y(l,v)&&(e="HTMLStartTagOpen",n=new u("<"),C(n,c))}else"."==c?(c=b[++a],e="JavaScriptPunctuator","."==c&&"."==b[a+1]&&(a+=
2)):h&&"@"==c?(g=b[a+1],a++,e="{"==g?"FusionObjectOpen":"("==g||"["==g?"FusionSelectorOpen":"JavaScriptInvalidCharacter",!y||"{"!=g&&"("!=g&&"["!=g||(a++,y&&(n=new u(c+g),C(n,g)))):(a++,e="JavaScriptInvalidCharacter");break;case "html":case "fhtml":case "HTMLStartTagClose":case "HTMLStartTagSelfClose":case "HTMLEndTagClose":case "HTMLCharacterReference":case "HTMLCommentClose":case "HTMLBogusCommentClose":case "HTMLDOCTYPEClose":case "HTMLCDATAOpen":case "HTMLCDATAClose":case "FusionStartTagClose":case "FusionStartTagSelfClose":case "FusionEndTagClose":case "FusionDirectiveTagClose":case "FusionSubstitutionClose":e=
"HTMLText";case "HTMLText":if(f&&"plaintext"==f.tag){a=b.length;q=">";s++;break}do if(c=b[a],m=!f||"<iframe"!=f.state&&"<noembed"!=f.state&&"<noframes"!=f.state&&"<style"!=f.state&&"<xmp"!=f.state?null:f.state.substr(1),"]"==c&&"]"==b[a+1]&&">"==b[a+2]&&f&&"<!CDATA"==f.state){if(a!=k)break;a+=3;e="HTMLCDATAClose";q=">";s++;break}else if("<"==c)if(g=b[a+1],l=!f||"<math"!=f.state&&"<svg"!=f.state?null:f.state.substr(1),v=!f||"<textarea"!=f.state&&"<title"!=f.state?null:f.state.substr(1),z(g)&&!m&&!v){if(a!=
k)break;a++;e="HTMLStartTagOpen";f&&C(f,c);break}else if("/"==g){if(a!=k)break;g=b[a+2];if(h&&"@"==g)a+=3,e="FusionEndTagOpen";else if(z(g)&&(!m&&!v||B(b,a,m||v,c))){if(a+=2,e="HTMLEndTagOpen",m||v||l&&B(b,a-2,l,c))q=">",s++}else if(m||v)continue;else a+=2,e="HTMLBogusCommentOpen";break}else if(h&&"@"==g){if(a!=k)break;a+=2;e="FusionStartTagOpen";break}else if("!"==g&&!m&&!v){if(a!=k)break;g=b[a+2];">"==g?(a+=2,e="HTMLBogusCommentOpen"):h&&"@"==g?(a+=3,e="FusionDirectiveTagOpen"):"-"==g&&"-"==b[a+
3]?(a+=4,e="HTMLCommentOpen"):(g=b.substr(a+2,7),"DOCTYPE"==g?(a+=9,e="HTMLDOCTYPEOpen"):"[CDATA["==g&&l?(a+=9,e="HTMLCDATAOpen",n=new u("<!CDATA")):(a+=2,e="HTMLBogusCommentOpen"));break}else{if("?"==g&&!m&&!v){if(a!=k)break;a+=2;e="HTMLBogusCommentOpen";break}}else if("&"==c&&!m){c=null;g=b[a+1];if("#"==g)if(g=b[a+2],"x"==g||"X"==g){if(g=b[a+3],x(g)){if(a!=k)break;a+=4;c=x}}else{if(t(g)){if(a!=k)break;a+=3;c=t}}else if(z(g)){if(a!=k)break;a+=2;c=M}if(c){for(e="HTMLCharacterReference";c(b[a]);)a++;
";"!=b[a++]&&a--;break}}else if(h&&"$"==c&&"{"==b[a+1]){if(a!=k)break;a+=2;e="FusionSubstitutionOpen";n=new u("<${");break}while(++a<d);break;case "HTMLStartTagOpen":case "HTMLEndTagOpen":if(z(b[a])){for(e="HTMLStartTagOpen"!=e?"HTMLEndTagName":"HTMLStartTagName";++a<d;){c=b[a];if("]"==c&&"]"==b[a+1]&&">"==b[a+2]&&f&&"<!CDATA"==f.state)break;if(">"==c||"/"==c||A(c))break}f&&(f.tag=b.substring(k,a).toLowerCase());break}case "HTMLEndTagName":case "HTMLEndTagText":case "HTMLEndTagWhitespace":g="HTMLStartTagOpen"!=
e;case "HTMLStartTagName":case "HTMLStartTagSolidus":case "HTMLStartTagWhitespace":case "HTMLAttributeName":case "HTMLAttributeOperator":case "HTMLAttributeValue":case "HTMLAttributeDoubleQuotedValue":case "HTMLAttributeSingleQuotedValue":case "FusionAttributeTemplateString":case "FusionAttributeTemplateStringTail":c=b[a];if(">"==c)a++,e=g?"HTMLEndTagClose":"HTMLStartTagClose",f&&((d=g)||(d=f.tag,d="area"==d||"base"==d||"br"==d||"col"==d||"embed"==d||"hr"==d||"img"==d||"input"==d||"keygen"==d||"link"==
d||"menuitem"==d||"meta"==d||"param"==d||"source"==d||"track"==d||"wbr"==d),d&&C(f,c),g||(h&&"fhtml"!=m||"script"!=f.tag)&&"style"!=f.tag&&"iframe"!=f.tag&&"math"!=f.tag&&"noembed"!=f.tag&&"noframes"!=f.tag&&"svg"!=f.tag&&"textarea"!=f.tag&&"title"!=f.tag&&"xmp"!=f.tag||(n=new u("<"+f.tag)),"plaintext"!=f.tag&&(f.tag=""));else if(A(c))for(a++,e=g?"HTMLEndTagWhitespace":"HTMLStartTagWhitespace";A(b[a]);)a++;else if(g)for(e="HTMLEndTagText";++a<d;){c=b[a];if(">"==c||A(c))break;if("]"==c&&"]"==b[a-1]&&
">"==b[a+1]&&f&&"<!CDATA"==f.state){if(--a!=k)break;a+=3;e="HTMLCDATAClose";q=">";s++;break}}else if("="==c&&l&&"HTMLAttributeName"==l.type)a++,e="HTMLAttributeOperator";else if(l&&"HTMLAttributeOperator"==l.type)for(l='"'==c||"'"==c||"`"==c&&h?c:null,e="`"==l?"FusionAttributeTemplateString":'"'==l?"HTMLAttributeDoubleQuotedValue":"'"==l?"HTMLAttributeSingleQuotedValue":"HTMLAttributeValue";++a<d;){c=b[a];if("]"==c&&"]"==b[a-1]&&">"==b[a+1]&&f&&"<!CDATA"==f.state){if(--a!=k)break;a+=3;e="HTMLCDATAClose";
q=">";s++;break}if(l)if("`"==l&&"\\"==c){if(++a>=d)break;"\r"==b[a]&&"\n"==b[a+1]&&a++}else if(c==l){a++;break}else{if("`"==l&&"$"==c&&"{"==b[a+1]){a+=2;e="FusionAttributeTemplateStringHead";n=new u("=`${");break}}else if(">"==c||A(c))break}else if("/"==c)if(c=b[++a],e="HTMLStartTagSolidus",">"==c)a++,e="HTMLStartTagSelfClose",f&&(C(f,c),f.tag="");else for(;"/"==c;)c=b[++a];else for(e="HTMLAttributeName";++a<d;){c=b[a];if("]"==c&&"]"==b[a-1]&&">"==b[a+1]&&f&&"<!CDATA"==f.state){if(--a!=k)break;a+=
3;e="HTMLCDATAClose";q=">";s++;break}if(">"==c||"/"==c||"="==c||A(c))break}break;case "HTMLCommentOpen":e="HTMLCommentText";case "HTMLCommentText":do{c=b[a];if("]"==c&&"]"==b[a+1]&&">"==b[a+2]&&f&&"<!CDATA"==f.state){if(a!=k)break;a+=3;e="HTMLCDATAClose";q=">";s++;break}if(">"==c){if(a==k&&l&&"HTMLCommentOpen"==l.type){a++;e="HTMLCommentClose";break}}else if("-"==c)if(g=b[a+1],">"==g){if(a==k&&l&&"HTMLCommentOpen"==l.type){a+=2;e="HTMLCommentClose";break}}else if("-"==g&&(g=b[a+2],">"==g||"!"==g&&
">"==b[a+3])){if(a!=k)break;a+="!"==g?4:3;e="HTMLCommentClose";break}}while(++a<d);break;case "HTMLBogusCommentOpen":e="HTMLBogusCommentText";case "HTMLBogusCommentText":do{c=b[a];if("]"==c&&"]"==b[a+1]&&">"==b[a+2]&&f&&"<!CDATA"==f.state){if(a!=k)break;a+=3;e="HTMLCDATAClose";q=">";s++;break}if(">"==c){if(a!=k)break;a++;e="HTMLBogusCommentClose";break}}while(++a<d);break;case "HTMLDOCTYPEOpen":case "HTMLDOCTYPEString":case "HTMLDOCTYPEDoubleQuotedString":case "HTMLDOCTYPESingleQuotedString":case "HTMLDOCTYPEWhitespace":c=
b[a];if(">"==c)a++,e="HTMLDOCTYPEClose";else if(A(c))for(a++,e="HTMLDOCTYPEWhitespace";A(b[a]);)a++;else for(l='"'==c||"'"==c?c:null,e='"'==c?"HTMLDOCTYPEDoubleQuotedString":"'"==c?"HTMLDOCTYPESingleQuotedString":"HTMLDOCTYPEString";++a<d;){c=b[a];if("]"==c&&"]"==b[a-1]&&">"==b[a+1]&&f&&"<!CDATA"==f.state){if(--a!=k)break;a+=3;e="HTMLCDATAClose";q=">";s++;break}if(l){if(c==l){a++;break}}else if(">"==c||A(c))break}break;case "css":case "fcss":case "CSSIdentifier":case "CSSNumber":case "CSSDelimiter":case "CSSPunctuator":case "CSSDimension":case "CSSPercentage":case "CSSComma":case "CSSColon":case "CSSSemicolon":case "CSSDoubleQuotedString":case "CSSSingleQuotedString":case "CSSHash":case "CSSFunction":case "CSSAtKeyword":case "CSSMatch":case "CSSUrl":case "CSSColumn":case "CSSUnicodeRange":case "CSSComment":case "CSSWhitespace":case "FusionObjectOpen":case "FusionObjectSubstitutionClose":case "FusionSelectorOpen":case "FusionSelectorSubstitutionClose":case "FusionStyleSubstitutionClose":c=
b[a];l=t(c);l||"+"!=c&&"-"!=c&&"."!=c||(g=b[a+1],l=t(g)||"."!=c&&"."==g&&t(b[a+2]));if(l){e="CSSNumber";if("."!=c){for(a++;t(b[a]);)a++;c=b[a]}if("."==c&&t(b[a+1])){for(a+=2;t(b[a]);)a++;c=b[a]}g=b[a+1];if(("e"==c||"E"==c)&&(t(g)||("+"==g||"-"==g)&&t(b[a+2]))){for(a+="+"==g||"-"==g?3:2;t(b[a]);)a++;c=b[a]}if("%"==c){a++;e="CSSPercentage";break}else if(!z(c)&&"_"!=c&&"\\"!=c&&"-"!=c&&"\u0080">c)break}if(l||z(c)||"_"==c||"\\"==c||"#"==c||"@"==c||"-"==c||"\u0080"<=c)if(l||"u"!=c&&"U"!=c||"+"!=b[a+1]||
!x(b[a+2])&&"?"!=b[a+2]){e=l?"CSSDimension":"#"==c?"CSSHash":"@"==c?"CSSAtKeyword":"CSSIdentifier";if("\\"==c){if(E(b[a+1])){l||a++;e=l?"CSSNumber":"CSSDelimiter";break}++a<d&&a++}else if("#"==c||"@"==c||"-"==c)if(g=b[a+1],z(g)||"_"==g||"-"==g||"\\"==g&&!E(b[a+2])||!("\u0080">g)||"#"==c&&t(g))if("@"==c&&"-"==g){g=b[a+2];if(!z(g)&&"_"!=g&&"-"!=g&&("\\"!=g||E(b[a+3]))&&"\u0080">g){a++;e="CSSDelimiter";break}a+=3}else a+=2;else{l||a++;e=l?"CSSNumber":"CSSDelimiter";break}else a++;do if(c=b[a],"\\"==
c){if(E(b[a+1]))break;if(++a>=d)break}else if(!M(c)&&"_"!=c&&"-"!=c&&"\u0080">c)break;while(++a<d);if("("==c&&"CSSIdentifier"==e&&(a++,e="CSSFunction",f&&C(f,c),a==k+4&&"url"==b.substr(k,3).toLowerCase())){for(c=0;A(b[a+c]);)c++;g=b[a+c];if('"'!=g&&"'"!=g){a+=c;e="CSSUrl";if(a>=d)break;do{c=b[a];if(!h&&"html"==m&&B(b,a,"style",c))break;if(")"==c){a++;break}else if("\\"==c&&++a>=d)break}while(++a<d)}}}else{a+=2;e="CSSUnicodeRange";for(c=0;6>c&&x(b[a+c]);)c++;g=b[a+c];if("-"==g&&x(b[a+c+1]))for(a+=
c+1,c=0;6>c&&x(b[a+c]);)c++;else if("?"==g)for(;6>c&&"?"==b[a+c];)c++;a+=c}else if("/"==c&&"*"==b[a+1])for(a++,e="CSSComment";++a<d;){c=b[a];if(!h&&"html"==m&&B(b,a,"style",c))break;if("*"==c&&"/"==b[a+1]){a+=2;break}}else if(A(c))for(a++,e="CSSWhitespace";A(b[a]);)a++;else if('"'==c||"'"==c)for(l=c,e='"'==l?"CSSDoubleQuotedString":"CSSSingleQuotedString";++a<d;){c=b[a];if(!h&&"html"==m&&B(b,a,"style",c))break;if("\\"==c){if(++a>=d)break;"\r"==b[a]&&"\n"==b[a+1]&&a++}else if(c==l){a++;break}else if(E(c))break}else if("$"==
c||"*"==c||"^"==c||"|"==c||"~"==c)g=b[a+1],h&&"$"==c&&"{"==g&&("fcss"==m||f&&("@{:"==f.state||"@("==f.state||"@["==f.state||"<style"==f.state))?(a+=2,e=f?"@{:"==f.state?"FusionObjectSubstitutionOpen":"@("==f.state||"@["==f.state?"FusionSelectorSubstitutionOpen":"FusionStyleSubstitutionOpen":"FusionStyleSubstitutionOpen",n=new u(f?f.state+c+g:c+g)):"|"==c&&"|"==g?(a+=2,e="CSSColumn"):"="==g?(a+=2,e="CSSMatch"):(a++,e="CSSDelimiter");else if("("==c||")"==c||"["==c||"]"==c||"{"==c||"}"==c)a++,e="CSSPunctuator",
f&&C(f,c);else if(","==c)a++,e="CSSComma";else if(":"==c)a++,e="CSSColon",f&&"@{"==f.state&&(q=c);else if(";"==c)a++,e="CSSSemicolon",f&&"@{:"==f.state&&(r="@{");else if("<"==c)if(c=b[++a],e="CSSDelimiter","!"==c&&"-"==b[a+1]&&"-"==b[a+2]&&f&&"<style"==f.state)for(a+=2,e="CSSComment";++a<d;){c=b[a];if(!h&&"html"==m&&B(b,a,"style",c))break;if("-"==c&&"-"==b[a+1]&&">"==b[a+2]){a+=3;break}}else"/"==c&&f&&"<style"==f.state&&B(b,a-1,"style","<")&&(a++,e="HTMLEndTagOpen",q=">",s++);else a++,e="CSSDelimiter";
break;default:return null}this.position=a;this.state=e;h&&f&&"<"==f.state&&0==f.tags?(q=">",s++,this.state="fjs"):h&&f&&(("@{"==f.state||"@{:"==f.state)&&0==f.braces||"@("==f.state&&0==f.parentheses||"@["==f.state&&0==f.brackets)?(e="@("==f.state||"@["==f.state?"FusionSelectorClose":"FusionObjectClose",r="@("==f.state?"@()":"@["==f.state?"@[]":"@{}",s++,this.state=e):n&&"HTMLStartTagClose"==e&&("<script"==n.state?this.state="js":"<style"==n.state&&(this.state="css"));f&&(r&&(f.state=r),q&&(f.state+=
q));if(y)if(n)if(s&&p){if(1<s)for(m=1;m<s;m++)y.pop();y[p-1]=n}else y.push(n);else if(s)for(m=1;m<=s;m++)y.pop();if(a==k)return null;l=new T(e,b,k,a);J(e)||N(e)||(this.expression=f&&s?f.state:"",this.token=l.clone());return l},!0);n(r,"peek",function(b,d){var k=new H;k.language=this.language;k.position=b||this.position;k.source=this.source;k.state=d||this.state;for(var l=k.next();l;){var n=l.type;if(!J(n)&&!N(n))break;l=k.next()}return l},!0);n(r,"reset",function(){this.chain=null;this.expression=
"";this.position=0;this.state="";this.token=null},!0);var R=function(b,d){H.apply(this,arguments);d&&(this.styleChain="fjs"==d||"fhtml"==d||"fcss"==d?[]:null)},p=R.prototype=O(r),ia=function(b,d,k){return b.clone()};p._clone=R;p._token=null;p.styleChain=null;n(p,"clone",function(){var b=r.clone.apply(this,arguments);b._token=this._token?this._token.clone():null;b.styleChain=this.styleChain?this.styleChain.map(ia):null;return b},!0);n(p,"equals",function(b){if(!(b instanceof R&&r.equals.apply(this,
arguments)))return!1;var d=b.styleChain,k=this.styleChain;if((k&&k.length||0)!=(d&&d.length||0)||!this._token!=!b._token||this._token&&!this._token.equals(b._token))return!1;if(k)for(var l=0,n=k.length;l<n;l++)if(!k[l].equals(d[l]))return!1;return!0},!0);n(p,"hack",function(){if(this.styleChain)return!1;r.hack.apply(this,arguments);var b=this.language;this.styleChain="fjs"==b||"html"==b||"fhtml"==b||"css"==b||"fcss"==b?[]:null;return!!this.styleChain},!0);n(p,"next",function(){var b=this.token,d=
this._token||r.next.apply(this,arguments),k=this.styleChain;if(!d)return null;var l=d.type;this._token||"HTMLDOCTYPEOpen"!=l?this._token&&(this._token=null):(this._token=d.clone(),this._token.start++,this._token.type="HTMLDOCTYPEDeclaration",d.end=d.start+1);if(!k)return d;if(!w(l,"CSS")){if(!b||!w(b.type,"CSS")||"FusionObjectSubstitutionOpen"==l||"FusionSelectorSubstitutionOpen"==l||"FusionStyleSubstitutionOpen"==l)return d;b=null;do{if(!k.length)break;b=k.pop()}while(b&&"*"!=b);return d}if(J(l)||
N(l))return d;b&&(w(b.type,"CSS")||"FusionObjectSubstitutionClose"==b.type||"FusionSelectorSubstitutionClose"==b.type||"FusionStyleSubstitutionClose"==b.type)||k.push("*");b&&"FusionObjectOpen"==b.type&&k.push("*{");var n=k.length-1,m=0<=n?k[n]:null,a="CSSPunctuator"==l?d.text():null;if("{"==a)"@"==m?k[n]=m+"{":k.push("*{");else if("}"==a)m&&"*"!=m&&k.pop();else if("CSSSemicolon"==l)"*{:"==m||"@{:"==m?k[n]=m[0]+"{":"@"==m&&k.pop();else if("CSSColon"!=l||"*{"!=m&&"@{"!=m){if(n="@{"==m&&"CSSIdentifier"==
l?this.peek(d.end):null,"CSSAtKeyword"!=l||"*"!=m&&"*{"!=m&&"@{"!=m?d.type="*{"==m&&"CSSIdentifier"==l||n&&"CSSColon"==n.type?"CSSDeclarationName":"*{:"==m||"@{:"==m?"CSSDeclarationValue":"*"==m||"@{"==m?"CSSSelector":"@"==m?"CSSAtRule":"CSSInvalidCharacters":(k.push("@"),d.type="CSSAtRule"),"*{:"==m||"@{:"==m)"CSSDelimiter"==l&&"!"==d.text()?(n=this.peek(d.end))&&"CSSIdentifier"==n.type&&"important"==n.text().toLowerCase()&&(n=this.peek(n.end))&&("CSSSemicolon"==n.type||"CSSPunctuator"==n.type&&
"}"==n.text())&&(d.type="CSSDeclarationImportant"):b&&"CSSDelimiter"==b.type&&"!"==b.text()&&"CSSIdentifier"==l&&"important"==d.text().toLowerCase()&&(n=this.peek(d.end))&&("CSSSemicolon"==n.type||"CSSPunctuator"==n.type&&"}"==n.text())&&(d.type="CSSDeclarationImportant")}else k[n]=m+":";return d},!0);n(p,"reset",function(){r.reset.apply(this,arguments);this.styleChain=this._token=null},!0);p=function(){};(p.prototype=O(r))._clone=p;F("highlight",function(b,d,k){b=new R(b,d||"fjs");d="";var l=null;
for(k||b.hack();l=b.next();)d+=l.html();return d});F("parse",function(b,d,k){});F("tokenize",function(b,d,k){b=new H(b,d||"fjs");d=null;var l=[];for(k||b.hack();d=b.next();)l.push({type:d.type,start:d.start,end:d.end});return l});F("transpile",function(b,d,k,l,n,m){b=new H(b,"fjs");for(var a="",e=null,h=null,p=[],r=function(a,b){return b.toUpperCase()};e=b.next();){if("FusionSelectorOpen"==e.type||"FusionSelectorSubstitutionClose"==e.type){var f="",q="FusionSelectorOpen"==e.type,g=!0;do if("FusionSelectorSubstitutionOpen"==
e.type)h=b.peek(),h&&"JavaScriptPunctuator"==h.type&&"}"==h.text()||(f+='"+(',g=!1),h=b.token;else if("FusionSelectorSubstitutionClose"==e.type)h&&"FusionSelectorSubstitutionOpen"==h.type||(f+=')+"',g=!0),h=b.token;else{if(!w(e.type,"CSS")&&"FusionSelectorOpen"!=e.type&&"FusionSelectorClose"!=e.type)break;N(e.type)||(h="FusionSelectorOpen"==e.type?e.text().substr(1):e.text(),f+=h.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n"),h=b.token)}while(e=b.next());var s=/^\(\s*(head|html|body)\s*\)$/i.exec(f);
s?(f=s[1].toLowerCase(),a+="document."+("html"==f?"documentElement":f)):(a+=q?"["==f[0]?(l||"document.__query")+'("':(k||"document.__find")+'("':')+"',a+=f.substr(q?1:0,f.length-(q&&g?2:1)),g&&(a+='")'))}else if("FusionObjectOpen"==e.type||"FusionObjectSubstitutionClose"==e.type){f="FusionObjectOpen"!=e.type;do if("FusionObjectSubstitutionOpen"==e.type)h&&"CSSColon"==h.type&&(a+='"'),(h=b.peek())&&"JavaScriptPunctuator"==h.type&&"}"==h.text()||(a+='"+('),h=b.token;else if("FusionObjectSubstitutionClose"==
e.type)h&&"FusionObjectSubstitutionOpen"==h.type||(a+=')+"'),h=b.token;else{if(!w(e.type,"CSS")&&"FusionObjectOpen"!=e.type&&"FusionObjectClose"!=e.type)break;if(!N(e.type)){if(q=J(e.type)?e:null)if(e=b.next(),!e){a+=q.text();break}if(f){if("FusionObjectClose"==e.type&&"fjs"==b.state){h&&"CSSSemicolon"==h.type||(a+='"');q&&(a+=q.text());a+=e.text();h=b.token;continue}else if("CSSSemicolon"==e.type){a+='"';f=!1;q&&(a+=q.text());h=b.token;continue}else q&&(a+=q.text().replace(/\n/g,"\\n\\\n"));"FusionObjectSubstitutionOpen"==
e.type?(h=b.peek())&&"JavaScriptPunctuator"==h.type&&"}"==h.text()||(a+='"+('):"FusionObjectSubstitutionClose"==e.type?h&&"FusionObjectSubstitutionOpen"==h.type||(a+=')+"'):a+=e.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"')}else"CSSIdentifier"!=e.type||!h||"FusionObjectOpen"!=h.type&&"CSSSemicolon"!=h.type?"CSSColon"==e.type?(q&&(a+=q.text()),a+=e.text()):"CSSSemicolon"==e.type?q&&(a+=q.text()):h&&"CSSColon"==h.type?(q&&(a+=q.text()),f=!0,"fjs"!=b.state&&(a+='"'),"FusionObjectSubstitutionOpen"==
e.type?(h=b.peek())&&"JavaScriptPunctuator"==h.type&&"}"==h.text()||(a+='"+('):"FusionObjectSubstitutionClose"==e.type?h&&"FusionObjectSubstitutionOpen"==h.type||(a+=')+"'):a+=e.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"')):(q&&(a+=q.text()),a+="FusionObjectOpen"==e.type?e.text().substr(1):e.text()):("CSSSemicolon"==h.type&&(a+=","),q&&(a+=q.text()),a+='"',a+=e.text().replace(/^-+/,"").replace(/-+([a-z])/ig,r),a+='"');h=b.token}}while(e=b.next())}if(!e)break;if("FusionProperty"==e.type)a+=".__"+
e.text().substr(1);else if("FusionSubstitutionOpen"==e.type||"FusionStyleSubstitutionOpen"==e.type)a+='"+(';else if("FusionSubstitutionClose"==e.type||"FusionStyleSubstitutionClose"==e.type)a+=')+"';else if("HTMLStartTagOpen"==e.type)p.length&&(a+=e.text());else if("HTMLStartTagName"==e.type)f=e.text(),p.push(f),f=f.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),a+=1<p.length?f:(d||"document.__create")+'("'+f+'")';else if(p.length)if("HTMLStartTagClose"==e.type)!h||"HTMLAttributeName"!=h.type&&"HTMLAttributeOperator"!=
h.type?!h||"FusionAttributeTemplateString"!=h.type&&"FusionAttributeTemplateStringTail"!=h.type||(a+=")"):a+='"")',f=p[p.length-1],"area"==f||"base"==f||"br"==f||"col"==f||"embed"==f||"hr"==f||"img"==f||"input"==f||"keygen"==f||"link"==f||"menuitem"==f||"meta"==f||"param"==f||"source"==f||"track"==f||"wbr"==f?(p.pop(),p.length&&(a+=e.text())):a+=1<p.length?e.text():"."+(m||"__html")+'("';else if("HTMLEndTagOpen"==e.type)a+=1<p.length?e.text():'")';else if("HTMLEndTagName"==e.type){f=e.text();if(f!=
p[p.length-1])throw"unmatched <"+p[p.length-1]+"> tag";1<p.length&&(a+=f.replace(/\\/g,"\\\\").replace(/"/g,'\\"'))}else if("HTMLStartTagSelfClose"==e.type||"HTMLEndTagClose"==e.type||"HTMLEndTagSelfClose"==e.type)"HTMLStartTagSelfClose"==e.type&&h&&"HTMLAttributeName"==h.type?a+='"")':"HTMLStartTagSelfClose"!=e.type||!h||"FusionAttributeTemplateString"!=h.type&&"FusionAttributeTemplateStringTail"!=h.type||(a+=")"),p.pop(),p.length&&(a+=e.text());else if(1==p.length&&"HTMLAttributeName"==e.type)h&&
"HTMLAttributeName"==h.type?a+='"")':!h||"FusionAttributeTemplateString"!=h.type&&"FusionAttributeTemplateStringTail"!=h.type||(a+=")"),a+="."+(n||"__attr")+'("',a+=e.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"'),a+='",';else if(1==p.length&&("HTMLAttributeValue"==e.type||"HTMLAttributeDoubleQuotedValue"==e.type||"HTMLAttributeSingleQuotedValue"==e.type)){f=e.text();"HTMLAttributeValue"!=e.type&&(f=f.substr(1,f.length-2));a+='"';e=0;for(q=f.length;e<q;){g=f[e];if("&"==g)if(h=f[e+1],"#"==h)if(h=
f[e+2],"x"==h||"X"==h){if(h=f[e+3],x(h)){e+=3;h="";do{g=f[e];if(!x(g))break;h+=g}while(++e<q);for(";"!=f[e++]&&e--;4>h.length;)h="0"+h;a+="\\u";a+=h;continue}}else{if("0"<=h&&"9">=h){e+=2;h="";do{g=f[e];if("0">g||"9"<g)break;h+=g}while(++e<q);";"!=f[e++]&&e--;for(h=ba(h,10).toString(16);4>h.length;)h="0"+h;a+="\\u";a+=h;continue}}else{if(z(h)){e++;h="&";do{g=f[e];if(!M(g))break;h+=g}while(++e<q);";"!=f[e++]?e--:h+=";";g=Q[h.substr(1)];V(g)?g="\\u"+S(g[0],4,"0")+"\\u"+S(g[1],4,"0"):g&&(g="\\u"+S(g,
4,"0"));a+=g?g:h;continue}}else if('"'==g){a+='\\"';e++;continue}else if("\n"==g){a+="\\n\\\n";e++;continue}else if("\\"==g){a+="\\\\";e++;continue}a+=g;e++}a+='")'}else if(1==p.length&&"HTMLStartTagSolidus"==e.type)h&&"HTMLAttributeName"==h.type?a+='"")':!h||"FusionAttributeTemplateString"!=h.type&&"FusionAttributeTemplateStringTail"!=h.type||(a+=")");else if("FusionAttributeTemplateString"==e.type||"FusionAttributeTemplateStringHead"==e.type||"FusionAttributeTemplateStringMiddle"==e.type||"FusionAttributeTemplateStringTail"==
e.type){f=e.text();e="`"==f[0];q="`"==f[f.length-1];if(e)a+='"';else if(!h||"FusionAttributeTemplateStringHead"!=h.type&&"FusionAttributeTemplateStringMiddle"!=h.type||"`"==h.source[h.end-1])a+=')+"';a+=f.substr(1,q?f.length-2:f.length-3).replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n");q?a+='"':(h=b.peek())&&"JavaScriptPunctuator"==h.type&&"}"==h.text()||(a+='"+(')}else if("HTMLText"==e.type||w(e.type,"CSS"))a+=e.text().replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n");else if("HTMLStartTagWhitespace"==
e.type)a+=h&&"HTMLAttributeOperator"==h.type?e.text():e.text().replace(/^[^\r\n]+/,"");else{if(1<p.length||"HTMLEndTagText"!=e.type&&"HTMLEndTagSolidus"!=e.type&&"HTMLAttributeOperator"!=e.type)a+=e.text()}else"JavaScriptTemplateString"==e.type?(f=e.text(),e="`"==f[0],q="`"==f[f.length-1],e&&h&&("JavaScriptIdentifier"==h.type||"JavaScriptPunctuator"==h.type&&(")"==h.text()||h.text())),e?a+='"':h&&"JavaScriptTemplateString"==h.type&&"`"!=h.source[h.end-1]||(a+=')+"'),a+=f.substr(1,q?f.length-2:f.length-
3).replace(/"/g,'\\"').replace(/\n/g,"\\n\\\n"),q?a+='"':(h=b.peek())&&"JavaScriptPunctuator"==h.type&&"}"==h.text()||(a+='"+(')):a+=e.text();h=b.token}if(p.length)throw"unmatched <"+p[p.length-1]+"> tag";return a});"function"==typeof define&&define.amd?define(function(){return G}):"undefined"!=typeof module&&null!=module&&module.exports?module.exports=G:function(b){var d=I.f_Shorthand,k=I.f_Writable;"string"!=typeof d&&(d=!0===d?"f":"");"boolean"!=typeof k&&(k="undefined"!=typeof I.intellisense);
!b||aa.call(b,"fusion")&&!k||(d&&n(b,d,G,k),n(b,"fusion",G,k))}(K.window===K?K:I)})(this);